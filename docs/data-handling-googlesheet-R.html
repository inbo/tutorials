<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Read data from google sheet</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">INBO tutorials</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Software installation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">As administrator</li>
    <li>
      <a href="installation-R-admin.html">R</a>
    </li>
    <li>
      <a href="installation-RStudio-admin.html">RStudio</a>
    </li>
    <li>
      <a href="installation-git-admin.html">git</a>
    </li>
    <li>
      <a href="installation-rtools-admin.html">Rtools</a>
    </li>
    <li>
      <a href="installation-latex-admin.html">LaTeX</a>
    </li>
    <li>
      <a href="installation-pandoc-admin.html">Pandoc</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">As user</li>
    <li>
      <a href="installation-R-user.html">R</a>
    </li>
    <li>
      <a href="installation-RStudio-user.html">RStudio</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Software development
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="development-styleguide-repos.html">Repository style guide</a>
    </li>
    <li>
      <a href="development-styleguide-R.html">R style guide</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    R tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="data-handling-googlesheet-R.html">Read data from GoogleSheet</a>
    </li>
    <li>
      <a href="data-handling-large-files-R.html">Reading and handling large data files in R</a>
    </li>
    <li>
      <a href="data-handling-database-R.html">Read data from INBO databases (SQL Server) from R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Git tutorials
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="manual-git.html">Git hands-on session</a>
    </li>
    <li>
      <a href="manual-git-workflow.html">Git collaborative workflow for command line</a>
    </li>
    <li>
      <a href="manual-git-fix-conflict.html">Fix merge conflict with a pull request</a>
    </li>
    <li>
      <a href="manual-git-undo-commits.html">Undo commits with command line</a>
    </li>
    <li>
      <a href="manual-git-without-internet.html">Git without internet connection</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Read data from google sheet</h1>

</div>


<pre class="r"><code>library(googlesheets)
library(dplyr)
library(ggplot2)</code></pre>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>The R package <a href="https://github.com/jennybc/googlesheets/blob/master/README.md">googlesheets</a> provides the functionality to retrieve data from a google sheet. Once the registration as a user is done and the permissions are granted, it enables to read and write to google sheets. Initiation of the authentification can be done with the <code>gs_auth</code> command.</p>
<pre class="r"><code>gs_auth()</code></pre>
<p>Google will ask to grant the package the permission to access your drive. This token is saved to in a file <code>.httr-oauth</code> in your current working directory. Make sure this is not part of your version control system. However, as we want to be able to make the running independent from the user authentification or without needing an interactive environment. Therefore, we can store the token in a file and get the authentification from there. The code loads the token from the file if the file exists. Otherwise a new token is created and stored in the file.</p>
<pre class="r"><code>if (file_test(&quot;-f&quot;, &quot;googlesheets_token.rds&quot;)) {
  gs_auth(token = &quot;googlesheets_token.rds&quot;)
} else {
  # first get the token, but not caching it in a local file
  token &lt;- gs_auth(cache = FALSE)
  # save the token into a file in the current directory
  saveRDS(token, file = &quot;googlesheets_token.rds&quot;)
}</code></pre>
<pre><code>## Auto-refreshing stale OAuth token.</code></pre>
<p>Make sure the token is savely stored within your project folder without sharing it or putting it into the version control history. If you need more power (e.g. necessity of integration services such as Travis CI), check the encryption options in <a href="https://rawgit.com/jennybc/googlesheets/master/vignettes/managing-auth-tokens.html">this manual</a>.</p>
<p>Once registered, an overview of your available google sheets is provided as follows:</p>
<pre class="r"><code>gs_ls()</code></pre>
<pre><code>## # A tibble: 188 × 10
##                 sheet_title        author  perm version
##                       &lt;chr&gt;         &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt;
## 1  overzicht SVZ migratie … joost.sturte…    rw     old
## 2        Opleiding Git(hub) stijn.vanhoey    rw     old
## 3       Opleiding scripting maarten.stev…    rw     old
## 4  INBO A1 publications 20…  peter.desmet    rw     old
## 5  400+ Tools and innovati…    jeroensbox    rw     old
## 6       T0 sources datasets sander.devis…    rw     old
## 7             INBO en lopen gerald.louet…    rw     old
## 8                Statistics  peter.desmet    rw     old
## 9  LifeWatch budget en uit… peter.desmet…    rw     old
## 10 vergelijking fotodataba… tanja.milotic    rw     old
## # ... with 178 more rows, and 6 more variables: updated &lt;dttm&gt;,
## #   sheet_key &lt;chr&gt;, ws_feed &lt;chr&gt;, alternate &lt;chr&gt;, self &lt;chr&gt;,
## #   alt_key &lt;chr&gt;</code></pre>
</div>
<div id="i-just-want-to-load-a-google-spreadsheet" class="section level2">
<h2>I just want to load a google spreadsheet</h2>
<p>Consider you have the authentification. You know the name, URL or key of the spreadheet and want to read this in, well use one of the functions <code>gs_title()</code>, <code>gs_url()</code> or <code>gs_key()</code>.</p>
<p>As an example, I want to work on the sheet called <code>TraitsRedListSpecies</code>. Finding the spreadheet is done as follows:</p>
<pre class="r"><code>redlists &lt;- gs_title(&quot;TraitsRedListSpecies&quot;)</code></pre>
<pre><code>## Sheet successfully identified: &quot;TraitsRedListSpecies&quot;</code></pre>
<p>An overview of the different sheets provides sufficient information to retrieve the dataset and work with them:</p>
<pre class="r"><code>gs_ws_ls(redlists)</code></pre>
<pre><code>##  [1] &quot;!Amphibians&quot;        &quot;BreedingBirds&quot;      &quot;!Butterflies&quot;      
##  [4] &quot;!CarabidBeetles&quot;    &quot;!Dragonflies&quot;       &quot;!Grasshoppers&quot;     
##  [7] &quot;!FreshwaterFishes&quot;  &quot;!Ladybirds&quot;         &quot;!Mammals&quot;          
## [10] &quot;!Reptiles&quot;          &quot;!SaproxylicBeetles&quot; &quot;!VascularPlants&quot;   
## [13] &quot;!Waterbugs&quot;</code></pre>
<p>So, getting the <code>BreedingBirds</code> sheet into a native R object can be done by reading the specific worksheet:</p>
<pre class="r"><code>breedingbirds &lt;- redlists %&gt;% 
        gs_read(ws = &quot;BreedingBirds&quot;)</code></pre>
<pre><code>## Accessing worksheet titled &#39;BreedingBirds&#39;.</code></pre>
<pre><code>## No encoding supplied: defaulting to UTF-8.</code></pre>
<p>Inspecting the data of the sheet:</p>
<pre class="r"><code>class(breedingbirds)</code></pre>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<pre class="r"><code>head(breedingbirds)</code></pre>
<pre><code>## # A tibble: 6 × 17
##   TaxonomicGroup Class           Order       Family  Genus     Species
##            &lt;chr&gt; &lt;chr&gt;           &lt;chr&gt;        &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;
## 1  BreedingBirds  Aves Accipitriformes Accipitridae Circus aeruginosus
## 2  BreedingBirds  Aves Accipitriformes Accipitridae Circus aeruginosus
## 3  BreedingBirds  Aves Accipitriformes Accipitridae Pernis    apivorus
## 4  BreedingBirds  Aves Accipitriformes Accipitridae  Buteo       buteo
## 5  BreedingBirds  Aves Accipitriformes Accipitridae Circus aeruginosus
## 6  BreedingBirds  Aves Accipitriformes Accipitridae Circus aeruginosus
## # ... with 11 more variables: Speciesname &lt;chr&gt;, SpeciesnameDutch &lt;chr&gt;,
## #   RLC &lt;chr&gt;, RLCEurope &lt;chr&gt;, Biome &lt;chr&gt;, Biotope &lt;chr&gt;,
## #   Lifespan &lt;chr&gt;, Mobility &lt;chr&gt;, Criteria &lt;chr&gt;, Spine &lt;chr&gt;,
## #   Trophy &lt;chr&gt;</code></pre>
<p>We can now start working on the data, e.g. make a plot of the number of species in each biotope divided based on the RLC level:</p>
<pre class="r"><code>ggplot(data = breedingbirds, aes(x = Biotope)) +
    geom_bar() + 
    facet_grid(RLC ~ .)</code></pre>
<p><img src="data-handling-googlesheet-R_files/figure-html/unnamed-chunk-10-1.png" width="1152" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
