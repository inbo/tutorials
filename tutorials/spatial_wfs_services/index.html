<!DOCTYPE html>
<html lang='en' dir='auto'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='How to use WFS (vectors/features) GIS services within R scripts'>
<meta name='theme-color' content='#c04384'>

<meta property='og:title' content='Using WFS services in R • Thierry Onkelinx'>
<meta property='og:description' content='How to use WFS (vectors/features) GIS services within R scripts'>
<meta property='og:url' content='/tutorials/spatial_wfs_services/'>
<meta property='og:site_name' content='INBO Tutorials'>
<meta property='og:type' content='article'><meta property='article:section' content='tutorials'><meta property='article:tag' content='gis'><meta property='article:tag' content='webservice'><meta property='article:tag' content='r'><meta property='article:tag' content='maps'><meta property='article:published_time' content='2023-08-31T00:00:00Z'/><meta property='article:modified_time' content='2023-08-31T00:00:00Z'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.88.1" />

  <title>Using WFS services in R • Thierry Onkelinx</title>
  <link rel='canonical' href='/tutorials/spatial_wfs_services/'>
  
  
  <link rel='icon' href='/favicon.ico'>
<link rel='stylesheet' href='/assets/css/main.ab98e12b.css'><link rel='stylesheet' href='/css/custom.css'><style>
:root{--color-accent:#c04384;}
</style>

  

</head>
<body class='page type-tutorials has-sidebar'>

  <div class='site'><div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'>Skip to Main Menu</a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='/'>
        <img src='/images/logo.png'>
      </a>
    </div>
    
    <h2 class='title site-title '>
      <a href='/'>
       
      </a>
    </h2>
    <div class='desc'>
    
    </div>
  </header>

</section>
<section class='widget widget-search sep-after'>
  <header>
    <h4 class='title widget-title'> </h4>
  </header>

  <form action='/search' id='search-form' class='search-form'>
    <label>
      <span class='screen-reader-text'>Search</span>
      <input id='search-term' class='search-term' type='search' name='q' placeholder='Search&hellip;'>
    </label></form>

</section>
<section class='widget widget-sidebar_menu sep-after'><nav id='sidebar-menu' class='menu sidebar-menu' aria-label='Sidebar Menu'>
    <div class='container'>
      <ul><li class='item'>
  <a href='/'>Home</a></li><li class='item'>
  <a href='/articles/'>Articles</a></li><li class='item has-current'>
  <a href='/tutorials/'>Tutorials</a></li><li class='item'>
  <a href='/create_tutorial/'>Create tutorial</a></li><li class='item has-children'>
  <a href='/installation/'>Installation</a><button class='sub-menu-toggler'>
    <span class='screen-reader-text'>expand sub menu</span>
    <span class='sign'></span>
  </button>

  <ul class='sub-menu'><li class='item'>
  <a href='/installation/administrator/'>For admins</a></li><li class='item'>
  <a href='/installation/user/'>For users</a></li></ul></li><li class='item'>
  <a href='/categories/'>Categories</a></li><li class='item'>
  <a href='https://github.com/inbo/tutorials'>Repository</a></li></ul>
    </div>
  </nav>

</section><section class='widget widget-taxonomy_cloud sep-after'>
  <header>
    <h4 class='title widget-title'>Tags</h4>
  </header>

  <div class='container list-container'>
  <ul class='list taxonomy-cloud no-shuffle'><li>
        <a href='/tags/analysis/' style='font-size:1.0512820512820513em'>analysis</a>
      </li><li>
        <a href='/tags/analysis-of-variance/' style='font-size:1em'>analysis of variance</a>
      </li><li>
        <a href='/tags/api/' style='font-size:1.0128205128205128em'>api</a>
      </li><li>
        <a href='/tags/bibliography/' style='font-size:1.0128205128205128em'>bibliography</a>
      </li><li>
        <a href='/tags/biodiversity/' style='font-size:1.0128205128205128em'>biodiversity</a>
      </li><li>
        <a href='/tags/biorad/' style='font-size:1em'>bioRad</a>
      </li><li>
        <a href='/tags/bookdown/' style='font-size:1.0128205128205128em'>bookdown</a>
      </li><li>
        <a href='/tags/brms/' style='font-size:1em'>brms</a>
      </li><li>
        <a href='/tags/checklist/' style='font-size:1.0256410256410255em'>checklist</a>
      </li><li>
        <a href='/tags/ci/' style='font-size:1.0128205128205128em'>ci</a>
      </li><li>
        <a href='/tags/coding-club/' style='font-size:1em'>coding club</a>
      </li><li>
        <a href='/tags/csl/' style='font-size:1.0128205128205128em'>csl</a>
      </li><li>
        <a href='/tags/data/' style='font-size:1.0256410256410255em'>data</a>
      </li><li>
        <a href='/tags/database/' style='font-size:1.0512820512820513em'>database</a>
      </li><li>
        <a href='/tags/development/' style='font-size:1.0128205128205128em'>development</a>
      </li><li>
        <a href='/tags/dplyr/' style='font-size:1em'>dplyr</a>
      </li><li>
        <a href='/tags/e-book/' style='font-size:1em'>e-book</a>
      </li><li>
        <a href='/tags/effectclass/' style='font-size:1.0256410256410255em'>effectclass</a>
      </li><li>
        <a href='/tags/endnote/' style='font-size:1em'>endnote</a>
      </li><li>
        <a href='/tags/etn/' style='font-size:1em'>etn</a>
      </li><li>
        <a href='/tags/explorative-data-analysis/' style='font-size:1em'>explorative data analysis</a>
      </li><li>
        <a href='/tags/frictionless/' style='font-size:1em'>frictionless</a>
      </li><li>
        <a href='/tags/gbif/' style='font-size:1.0128205128205128em'>gbif</a>
      </li><li>
        <a href='/tags/generalized-linear-regression/' style='font-size:1.0128205128205128em'>generalized linear regression</a>
      </li><li>
        <a href='/tags/ggplot2/' style='font-size:1.0128205128205128em'>ggplot2</a>
      </li><li>
        <a href='/tags/gis/' style='font-size:1.1282051282051282em'>gis</a>
      </li><li>
        <a href='/tags/git/' style='font-size:1.1282051282051282em'>git</a>
      </li><li>
        <a href='/tags/gitbook/' style='font-size:1.0128205128205128em'>gitbook</a>
      </li><li>
        <a href='/tags/github/' style='font-size:1.0384615384615385em'>github</a>
      </li><li>
        <a href='/tags/google/' style='font-size:1.0128205128205128em'>google</a>
      </li><li>
        <a href='/tags/grids/' style='font-size:1em'>grids</a>
      </li><li>
        <a href='/tags/gwlogger/' style='font-size:1.0384615384615385em'>gwloggeR</a>
      </li><li>
        <a href='/tags/inbodb/' style='font-size:1.0256410256410255em'>inbodb</a>
      </li><li>
        <a href='/tags/inbomd/' style='font-size:1.0384615384615385em'>INBOmd</a>
      </li><li>
        <a href='/tags/inborutils/' style='font-size:1.0384615384615385em'>inborutils</a>
      </li><li>
        <a href='/tags/inla/' style='font-size:1.0256410256410255em'>INLA</a>
      </li><li>
        <a href='/tags/inlabru/' style='font-size:1em'>inlabru</a>
      </li><li>
        <a href='/tags/inlatools/' style='font-size:1.0256410256410255em'>inlatools</a>
      </li><li>
        <a href='/tags/installation/' style='font-size:1.1153846153846154em'>installation</a>
      </li><li>
        <a href='/tags/literature/' style='font-size:1.0512820512820513em'>literature</a>
      </li><li>
        <a href='/tags/maps/' style='font-size:1.0769230769230769em'>maps</a>
      </li><li>
        <a href='/tags/markdown/' style='font-size:1.0256410256410255em'>markdown</a>
      </li><li>
        <a href='/tags/mendeley/' style='font-size:1em'>mendeley</a>
      </li><li>
        <a href='/tags/mgrs/' style='font-size:1em'>mgrs</a>
      </li><li>
        <a href='/tags/mixed-model/' style='font-size:1.064102564102564em'>mixed model</a>
      </li><li>
        <a href='/tags/mixed-models/' style='font-size:1em'>mixed models</a>
      </li><li>
        <a href='/tags/multivariate-statistics/' style='font-size:1em'>multivariate statistics</a>
      </li><li>
        <a href='/tags/n2khab/' style='font-size:1.0512820512820513em'>n2khab</a>
      </li><li>
        <a href='/tags/open-science/' style='font-size:1.0897435897435896em'>open science</a>
      </li><li>
        <a href='/tags/packages/' style='font-size:1.0384615384615385em'>packages</a>
      </li><li>
        <a href='/tags/pandoc/' style='font-size:1.0128205128205128em'>pandoc</a>
      </li><li>
        <a href='/tags/python/' style='font-size:1em'>python</a>
      </li><li>
        <a href='/tags/r/' style='font-size:2em'>r</a>
      </li><li>
        <a href='/tags/renv/' style='font-size:1em'>renv</a>
      </li><li>
        <a href='/tags/reports/' style='font-size:1.0128205128205128em'>reports</a>
      </li><li>
        <a href='/tags/rgbif/' style='font-size:1.064102564102564em'>rgbif</a>
      </li><li>
        <a href='/tags/rmarkdown/' style='font-size:1.0256410256410255em'>rmarkdown</a>
      </li><li>
        <a href='/tags/rstudio/' style='font-size:1.0512820512820513em'>rstudio</a>
      </li><li>
        <a href='/tags/spreadsheet/' style='font-size:1em'>spreadsheet</a>
      </li><li>
        <a href='/tags/sql/' style='font-size:1em'>SQL</a>
      </li><li>
        <a href='/tags/stan/' style='font-size:1em'>stan</a>
      </li><li>
        <a href='/tags/styleguide/' style='font-size:1.0384615384615385em'>styleguide</a>
      </li><li>
        <a href='/tags/tidyverse/' style='font-size:1.0384615384615385em'>tidyverse</a>
      </li><li>
        <a href='/tags/uncertainty/' style='font-size:1.0128205128205128em'>uncertainty</a>
      </li><li>
        <a href='/tags/utm/' style='font-size:1em'>utm</a>
      </li><li>
        <a href='/tags/version-control/' style='font-size:1.1025641025641026em'>version control</a>
      </li><li>
        <a href='/tags/vignette/' style='font-size:1.4871794871794872em'>vignette</a>
      </li><li>
        <a href='/tags/visual-markdown-editing/' style='font-size:1em'>visual markdown editing</a>
      </li><li>
        <a href='/tags/vmm/' style='font-size:1em'>vmm</a>
      </li><li>
        <a href='/tags/waterinfo/' style='font-size:1.0256410256410255em'>wateRinfo</a>
      </li><li>
        <a href='/tags/watina/' style='font-size:1.0256410256410255em'>watina</a>
      </li><li>
        <a href='/tags/webservice/' style='font-size:1.0384615384615385em'>webservice</a>
      </li><li>
        <a href='/tags/windows/' style='font-size:1em'>windows</a>
      </li><li>
        <a href='/tags/zenodo/' style='font-size:1em'>zenodo</a>
      </li><li>
        <a href='/tags/zotero/' style='font-size:1.0128205128205128em'>zotero</a>
      </li></ul>
</div>


</section>
<section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'>
    <ul><li>
        <a href='https://github.com/inbo' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Github account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/INBOVlaanderen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Twitter account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://facebook.com/INBOVlaanderen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Facebook account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
  
</svg>
</a>
      </li></ul>
  </nav>
</section>
<section class='widget widget-build_time sep-after'>
  <p><small>Built on: Fri Feb 21 08:32:05 UTC 2025</small></p>
</section></div>

  <div class='sidebar-overlay'></div>
</div><div class='main'><a class='screen-reader-text' href='#content'>Skip to Content</a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'>Toggle Sidebar</span>
  <span class='open'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="3" y1="12" x2="21" y2="12" />
  <line x1="3" y1="6" x2="21" y2="6" />
  <line x1="3" y1="18" x2="21" y2="18" />
  
</svg>
</span>
  <span class='close'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
  
</svg>
</span>
</button><div class='header-widgets'>
        <div class='container'>
    
    <style>.widget-breadcrumbs li:after{content:'\2f '}</style>
  <section class='widget widget-breadcrumbs sep-after'>
    <nav id='breadcrumbs'>
      <ol><li><a href='/'>Home</a></li><li><a href='/tutorials/'>Tutorials</a></li><li><span>Using WFS services in R</span></li></ol>
    </nav>
  </section></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>INBO Tutorials</p><p class='desc site-desc'></p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Using WFS services in R</h1>
      
<p class='desc'>How to use WFS (vectors/features) GIS services within R scripts</p>


    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2023-08-31T00:00:00Z'>2023, Aug 31</time>
</span>

  <span class='byline'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M21,21V20c0-2.76-4-5-9-5s-9,2.24-9,5v1"/>
  <path d="M16,6.37A4,4,0,1,1,12.63,3,4,4,0,0,1,16,6.37Z"/>
  
</svg>
<span class='screen-reader-text'> by </span><a href='/authors/thierryo'>Thierry Onkelinx</a>, <a href='/authors/hansvancalster'>Hans Van Calster</a>, <a href='/authors/florisvdh'>Floris Vanderhaeghe</a></span>
  <br/>
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
25 mins read
</span>


  <span class="github-link">

    

        

        
            
        

        
            <a href='https://github.com/inbo/tutorials/edit/master/content/tutorials/spatial_wfs_services/index.Rmd'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
Improve this page</a>
        

        
    
</span>

</div>


  </div>
</header>

  
  

  <div class='container entry-content'><h1 id="what-is-wfs">What is WFS?<a href="#what-is-wfs" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<p>In computing, the <a href="http://www.opengeospatial.org/standards/wfs">Open Geospatial Consortium (OGC) <strong>Web Feature
Service (WFS)</strong></a> Interface
Standard provides an interface allowing requests for geographical
features across the web using platform-independent calls. One can think
of geographical features as the “source code” behind a map, whereas the
Web Mapping Service (WMS) interface or online tiled mapping portals like
Google Maps return only an image, which end-users cannot edit or
spatially analyze.</p>
<p>The standard output format for reading or downloading data from a WFS is
the XML-based Geography Markup Language (GML), but other formats like
shapefiles or geojson are also available. In early 2006 the OGC members
approved the OpenGIS GML Simple Features Profile. This profile is
designed both to increase interoperability between WFS servers and to
improve the ease of implementation of the WFS standard. (Source:
<a href="https://en.wikipedia.org/wiki/Web_Feature_Service">Wikipedia</a>)</p>
<p>Before we embark on using a WFS service in R, we would like to draw your
attention to the following issue when using a WFS service in a workflow
that needs to be reproducible in the longer term. A distributed, stable
storage of the GIS data used in a workflow is necessary to make that
workflow reproducible on a longer term. When using dynamic databases and
web services, where the data they present are expected to evolve
(e.g. by always pointing at the latest release in these WFS-cases), this
is not guaranteed if you just use the WFS service to directly read GIS
data from it. Instead of directly reading the GIS data, it is also
possible to download the data from the WFS service to disk (and possibly
archive on, e.g., Zenodo) in order to obtain a stable version that can
be re-used later by reading it from disk. Also, in case it takes a long
time to get the GIS data from the WFS service, downloading instead of
directly reading is often a better choice. On the other hand, some types
of workflows might instead require the most up to date GIS data that are
available to be retrieved while no workflow reproducibility is needed.
Do note that publishing the workflow is always recommended for published
work. It serves the scientific community and it is also a way of proving
scientific quality - hence reproducibility is often the best choice for
published work.</p>
<p>Some of the material presented in this tutorial benefitted from a
tutorial presented at the Use of R in Official Statistics conference in
The Hague, September 2018 <a href="https://github.com/TWIAV/Spatial_Analysis_in_R_with_Open_Geodata/">Spatial Analysis in R with Open
Geodata</a>,
from Lovelace, Nowosad, and Muenchow (2020) and from <a href="https://friesewoudloper.wordpress.com/2015/05/17/het-bevragen-van-een-wfs-in-de-browser-voorbeelden-aan-de-hand-van-de-bag-service/">this Dutch
wordpress
blogpost</a>.</p>
<h1 id="useful-overviews-of-web-feature-services">Useful overviews of web feature services<a href="#useful-overviews-of-web-feature-services" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<p>WFS (and WM(T)S) services for Belgium and regions in Belgium:</p>
<ul>
<li><a href="https://www.vlaanderen.be/digitaal-vlaanderen/onze-oplossingen/geografische-webdiensten/ons-gis-aanbod/overdrachtdiensten">overview of WFS services for Flanders
region</a></li>
<li><a href="https://wfs.michelstuyts.be/">overview compiled by Michel Stuyts</a>,
which is <a href="https://gitlab.com/GIS-projects/Belgium-WFS/">also available on
gitlab</a></li>
<li><a href="https://dov.vlaanderen.be/page/interessante-webservices">overview maintained by DOV
Vlaanderen</a></li>
<li><a href="https://www.geo.be/home?l=en">Geoportal of the Belgian federal institutions, notably
NGI</a>: several of these services can be
viewed interactively at the <a href="https://topomapviewer.ngi.be">NGI
TopoMapViewer</a>, including the
<a href="https://www.ngi.be/website/aanbod/digitale-geodata/cartoweb-be/">CartoWeb.be</a>
WMS/WMTS service</li>
<li><a href="https://opendata.meteo.be/">KMI meteo data</a></li>
</ul>
<p>European portals:</p>
<ul>
<li><a href="https://inspire-geoportal.ec.europa.eu/">inspire geoportal</a>: European
portal for spatial data - some of which have a WFS service</li>
<li><a href="https://discomap.eea.europa.eu/Index/">environmental data for
Europe</a>: many of the products
listed have either a WMS or a WFS service</li>
</ul>
<p>Worldwide coverage:</p>
<ul>
<li><a href="https://directory.spatineo.com/">spatineo directory</a></li>
</ul>
<h1 id="used-packages">Used packages<a href="#used-packages" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">library</span>(sf) <span style="color:#aaa;font-style:italic"># simple features packages for handling vector GIS data</span>
<span style="color:#0a0">library</span>(httr) <span style="color:#aaa;font-style:italic"># generic webservice package</span>
<span style="color:#0a0">library</span>(tidyverse) <span style="color:#aaa;font-style:italic"># a suite of packages for data wrangling, transformation, plotting, ...</span>
<span style="color:#0a0">library</span>(ows4R) <span style="color:#aaa;font-style:italic"># interface for OGC webservices</span>
</code></pre></div><p>In this tutorial, we take a coding approach to show how to get data from
a web feature service. You may also be interested in the <code>inbospatial</code>
package, which wraps some of the material presented here in more
user-friendly functions. The <code>inbospatial</code> package has a <a href="https://inbo.github.io/inbospatial/articles/wfs_wcs.html">separate
tutorial</a>
which explains how to get data from web feature and (some) web coverage
services using these functions.</p>
<h1 id="get-to-know-what-the-service-can-do-with-getcapabilities">Get to know what the service can do with <code>GetCapabilities</code><a href="#get-to-know-what-the-service-can-do-with-getcapabilities" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<p>First of all we need the URL of the service.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">wfs_bwk &lt;- <span style="color:#a50">&#34;https://geo.api.vlaanderen.be/BWK/wfs&#34;</span>
</code></pre></div><p>Next, we append information to the URL address with the aid of
<code>httr::parse_url</code> and <code>httr::build_url</code>. The former function parses an
URL into a list for easier programmatic addition of information to the
URL. The latter function does the reverse and builds the URL from the
list object.</p>
<p>The <code>url$query</code> slot is where you instruct the WFS what information it
should return. It is constructed as a list with name-value pairs. For
now, we only need to specify the <code>GetCapabilities</code> request. Other
information such as passing <code>version = 2.0.0</code> can be added, but is not
required (by default, the latest version of the WFS service will be
chosen).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">url &lt;- <span style="color:#0a0">parse_url</span>(wfs_bwk)
url$query &lt;- <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                  <span style="color:#aaa;font-style:italic">#version = &#34;2.0.0&#34;, # facultative</span>
                  request = <span style="color:#a50">&#34;GetCapabilities&#34;</span>
                  )
request &lt;- <span style="color:#0a0">build_url</span>(url)
request
</code></pre></div><pre><code>## [1] &quot;https://geo.api.vlaanderen.be/BWK/wfs?service=wfs&amp;request=GetCapabilities&quot;
</code></pre>
<p>With <code>GetCapabilities</code>, we obtain a complete overview of all metadata
for the web service.</p>
<p>To see all capabilities, you can visit <a href="https://geo.api.vlaanderen.be/BWK/wfs?service=wfs&amp;request=GetCapabilities">the request in the
webbrowser</a>.
For instance opening the page in the webbrowser and searching for
“Filter_Capabilities” allows you to see all possible ways to filter the
data from a WFS layer (e.g. restrict the downloaded data to a specified
bounding box with <code>SpatialOperator name=&quot;BBOX&quot;</code>).</p>
<p>Instead of searching the page on the web, there are several ways to
access specific pieces of information programmatically. We will show
here how to do this using functions in the <code>ows4R</code> package. The first
thing we need to do is generate a connection to the WFS with the aid of
<code>WFSClient$new()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client &lt;- WFSClient$<span style="color:#0a0">new</span>(wfs_bwk, 
                            serviceVersion = <span style="color:#a50">&#34;2.0.0&#34;</span>) <span style="color:#aaa;font-style:italic">#serviceVersion must be provided here</span>
</code></pre></div><p>The resulting object <code>bwk_client</code> is an R6 object. If you are not
familiar with R6 object, you might want to read <a href="https://adv-r.hadley.nz/r6.html">the R6 chapter in
Advanced R</a>.</p>
<p>Printing `<code>bwk_client</code> looks like this:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client
</code></pre></div><pre><code>## &lt;WFSClient&gt;
##   Inherits from: &lt;OWSClient&gt;
##   Public:
##     attrs: list
##     capabilities: WFSCapabilities, OWSCapabilities, OGCAbstractObject, R6
##     clone: function (deep = FALSE) 
##     defaults: list
##     describeFeatureType: function (typeName) 
##     element: AbstractObject
##     encode: function (addNS = TRUE, geometa_validate = TRUE, geometa_inspire = FALSE, 
##     ERROR: function (text) 
##     getCapabilities: function () 
##     getCASUrl: function () 
##     getClass: function () 
##     getClassName: function () 
##     getConfig: function () 
##     getFeatures: function (typeName, ...) 
##     getFeatureTypes: function (pretty = FALSE) 
##     getHeaders: function () 
##     getNamespaceDefinition: function (recursive = FALSE) 
##     getPwd: function () 
##     getToken: function () 
##     getUrl: function () 
##     getUser: function () 
##     getVersion: function () 
##     INFO: function (text) 
##     initialize: function (url, serviceVersion = NULL, user = NULL, pwd = NULL, 
##     isFieldInheritedFrom: function (field) 
##     logger: function (type, text) 
##     loggerType: NULL
##     namespace: OWSNamespace, R6
##     reloadCapabilities: function () 
##     url: https://geo.api.vlaanderen.be/BWK/wfs
##     verbose.debug: FALSE
##     verbose.info: FALSE
##     version: 2.0.0
##     WARN: function (text) 
##     wrap: FALSE
##   Private:
##     cas_url: NULL
##     config: request
##     fromComplexTypes: function (value) 
##     headers: NULL
##     pwd: NULL
##     serviceName: WFS
##     system_fields: verbose.info verbose.debug loggerType wrap element names ...
##     token: NULL
##     user: NULL
##     xmlElement: AbstractObject
##     xmlExtraNamespaces: NULL
##     xmlNamespacePrefix: OWS
##     xmlNodeToCharacter: function (x, ..., indent = &quot;&quot;, tagSeparator = &quot;\n&quot;)
</code></pre>
<p>The features listed can be accessed using <code>$</code>. We can see that some of
them are again functions. As a first example, the following code will
list all available layers for that WFS.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$<span style="color:#0a0">getFeatureTypes</span>(pretty = <span style="color:#00a">TRUE</span>)
</code></pre></div><pre><code>##           name                                    title
## 1   BWK:Bwkhab  BWK 2 - BWK-zone en Natura 2000 Habitat
## 2 BWK:Bwkfauna BWK 2 - Faunistisch belangrijke gebieden
## 3  BWK:Hab3260                 BWK 2 - Habitattype 3260
</code></pre>
<p>Another way of accessing this information is:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$<span style="color:#0a0">getFeatureTypes</span>() %&gt;%
  <span style="color:#0a0">map_chr</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getName</span>()})
</code></pre></div><pre><code>## [1] &quot;BWK:Bwkhab&quot;   &quot;BWK:Bwkfauna&quot; &quot;BWK:Hab3260&quot;
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$<span style="color:#0a0">getFeatureTypes</span>() %&gt;%
  <span style="color:#0a0">map_chr</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getTitle</span>()})
</code></pre></div><pre><code>## [1] &quot;BWK 2 - BWK-zone en Natura 2000 Habitat&quot; 
## [2] &quot;BWK 2 - Faunistisch belangrijke gebieden&quot;
## [3] &quot;BWK 2 - Habitattype 3260&quot;
</code></pre>
<p>We are using <code>purrr::map()</code> functionalities here, because the output of
<code>bwk_client$getFeatureTypes()</code> is a list and each element of the list
contains information about a layer.</p>
<p>Let’s turn back our attention to <code>getCapabilities()</code> and see what
information we can extract from it.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$<span style="color:#0a0">getCapabilities</span>()
</code></pre></div><pre><code>## &lt;WFSCapabilities&gt;
##   Inherits from: &lt;OWSCapabilities&gt;
##   Public:
##     attrs: list
##     clone: function (deep = FALSE) 
##     defaults: list
##     element: Capabilities
##     encode: function (addNS = TRUE, geometa_validate = TRUE, geometa_inspire = FALSE, 
##     ERROR: function (text) 
##     findFeatureTypeByName: function (expr, exact = TRUE) 
##     getClass: function () 
##     getClassName: function () 
##     getClient: function () 
##     getFeatureTypes: function (pretty = FALSE) 
##     getNamespaceDefinition: function (recursive = FALSE) 
##     getOperationsMetadata: function () 
##     getOWSVersion: function () 
##     getRequest: function () 
##     getService: function () 
##     getServiceIdentification: function () 
##     getServiceProvider: function () 
##     getServiceVersion: function () 
##     getUrl: function () 
##     INFO: function (text) 
##     initialize: function (url, version, logger = NULL, ...) 
##     isFieldInheritedFrom: function (field) 
##     logger: function (type, text) 
##     loggerType: NULL
##     namespace: NULL
##     setClient: function (client) 
##     verbose.debug: FALSE
##     verbose.info: FALSE
##     WARN: function (text) 
##     wrap: FALSE
##   Private:
##     client: WFSClient, OWSClient, OGCAbstractObject, R6
##     featureTypes: list
##     fetchFeatureTypes: function (xmlObj, version) 
##     fromComplexTypes: function (value) 
##     operationsMetadata: OWSOperationsMetadata, R6
##     owsVersion: 1.1
##     request: OWSGetCapabilities, OWSHttpRequest, OGCAbstractObject, R6
##     service: WFS
##     serviceIdentification: OWSServiceIdentification, R6
##     serviceProvider: OWSServiceProvider, R6
##     serviceVersion: 2.0.0
##     system_fields: verbose.info verbose.debug loggerType wrap element names ...
##     url: https://geo.api.vlaanderen.be/BWK/wfs
##     xmlElement: Capabilities
##     xmlExtraNamespaces: NULL
##     xmlNamespacePrefix: WFS_1_1
##     xmlNodeToCharacter: function (x, ..., indent = &quot;&quot;, tagSeparator = &quot;\n&quot;)
</code></pre>
<p>This is again an R6 class object and the <code>$</code> can be used to chain
together several functions, much in the same way as the pipe operator
<code>%&gt;%</code>. The following chunk illustrates its use. Try executing this
incrementally (select and execute code up to first <code>$</code>, second <code>$</code>, …)
to see what happens.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$
  <span style="color:#0a0">getCapabilities</span>()$
  <span style="color:#0a0">findFeatureTypeByName</span>(<span style="color:#a50">&#34;BWK:Bwkhab&#34;</span>)$
  <span style="color:#0a0">getDescription</span>() %&gt;%
  <span style="color:#0a0">map_chr</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getName</span>()})
</code></pre></div><pre><code>##  [1] &quot;UIDN&quot;       &quot;OIDN&quot;       &quot;TAG&quot;        &quot;EVAL&quot;       &quot;EENH1&quot;     
##  [6] &quot;EENH2&quot;      &quot;EENH3&quot;      &quot;EENH4&quot;      &quot;EENH5&quot;      &quot;EENH6&quot;     
## [11] &quot;EENH7&quot;      &quot;EENH8&quot;      &quot;V1&quot;         &quot;V2&quot;         &quot;V3&quot;        
## [16] &quot;HERK&quot;       &quot;INFO&quot;       &quot;BWKLABEL&quot;   &quot;HAB1&quot;       &quot;PHAB1&quot;     
## [21] &quot;HAB2&quot;       &quot;PHAB2&quot;      &quot;HAB3&quot;       &quot;PHAB3&quot;      &quot;HAB4&quot;      
## [26] &quot;PHAB4&quot;      &quot;HAB5&quot;       &quot;PHAB5&quot;      &quot;HERKHAB&quot;    &quot;HERKPHAB&quot;  
## [31] &quot;HABLEGENDE&quot; &quot;SHAPE&quot;
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#aaa;font-style:italic"># or shorter</span>
bwk_client$
  <span style="color:#0a0">describeFeatureType</span>(typeName = <span style="color:#a50">&#34;BWK:Bwkhab&#34;</span>) %&gt;%
  <span style="color:#0a0">map_chr</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getName</span>()})
</code></pre></div><pre><code>##  [1] &quot;UIDN&quot;       &quot;OIDN&quot;       &quot;TAG&quot;        &quot;EVAL&quot;       &quot;EENH1&quot;     
##  [6] &quot;EENH2&quot;      &quot;EENH3&quot;      &quot;EENH4&quot;      &quot;EENH5&quot;      &quot;EENH6&quot;     
## [11] &quot;EENH7&quot;      &quot;EENH8&quot;      &quot;V1&quot;         &quot;V2&quot;         &quot;V3&quot;        
## [16] &quot;HERK&quot;       &quot;INFO&quot;       &quot;BWKLABEL&quot;   &quot;HAB1&quot;       &quot;PHAB1&quot;     
## [21] &quot;HAB2&quot;       &quot;PHAB2&quot;      &quot;HAB3&quot;       &quot;PHAB3&quot;      &quot;HAB4&quot;      
## [26] &quot;PHAB4&quot;      &quot;HAB5&quot;       &quot;PHAB5&quot;      &quot;HERKHAB&quot;    &quot;HERKPHAB&quot;  
## [31] &quot;HABLEGENDE&quot; &quot;SHAPE&quot;
</code></pre>
<p>This lists all available fields for the layer “BWK:Bwkhab”.</p>
<p>Here is how to get a character vector naming all available operations of
the WFS:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$
  <span style="color:#0a0">getCapabilities</span>()$
  <span style="color:#0a0">getOperationsMetadata</span>()$
  <span style="color:#0a0">getOperations</span>() %&gt;%
  <span style="color:#0a0">map_chr</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getName</span>()})
</code></pre></div><pre><code>## [1] &quot;GetCapabilities&quot;       &quot;DescribeFeatureType&quot;   &quot;GetFeature&quot;           
## [4] &quot;GetPropertyValue&quot;      &quot;ListStoredQueries&quot;     &quot;DescribeStoredQueries&quot;
## [7] &quot;CreateStoredQuery&quot;     &quot;DropStoredQuery&quot;
</code></pre>
<p>The next chunk shows how we can extract the available output formats. We
will see later that <code>GetFeature</code> is the operation needed to read or
download data from the WFS. The metadata for this operation has what we
want and we can extract it with a combination of <code>purrr::map()</code> and
`<code>purrr::pluck()</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$
  <span style="color:#0a0">getCapabilities</span>()$
  <span style="color:#0a0">getOperationsMetadata</span>()$
  <span style="color:#0a0">getOperations</span>() %&gt;%
  <span style="color:#0a0">map</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getParameters</span>()}) %&gt;%
  <span style="color:#0a0">pluck</span>(<span style="color:#099">3</span>, <span style="color:#a50">&#34;outputFormat&#34;</span>)
</code></pre></div><pre><code>##  [1] &quot;text/xml; subtype=gml/3.2&quot;           
##  [2] &quot;gml32&quot;                               
##  [3] &quot;application/gml+xml; version=3.2&quot;    
##  [4] &quot;GML2&quot;                                
##  [5] &quot;KML&quot;                                 
##  [6] &quot;SHAPE-ZIP&quot;                           
##  [7] &quot;application/json&quot;                    
##  [8] &quot;application/vnd.google-earth.kml xml&quot;
##  [9] &quot;application/vnd.google-earth.kml+xml&quot;
## [10] &quot;csv&quot;                                 
## [11] &quot;gml3&quot;                                
## [12] &quot;json&quot;                                
## [13] &quot;text/xml; subtype=gml/2.1.2&quot;         
## [14] &quot;text/xml; subtype=gml/3.1.1&quot;
</code></pre>
<!--
Another interesting piece of metadata we might be interested in is which spatial operations the WFS service is able to do. 
-->
<p>Some more examples follow. Let’s extract the bounding boxes for all
layers.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$
  <span style="color:#0a0">getCapabilities</span>()$ 
  <span style="color:#0a0">getFeatureTypes</span>() %&gt;%  
  <span style="color:#0a0">map</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getBoundingBox</span>()})
</code></pre></div><pre><code>## [[1]]
##         min       max
## x  2.525262  5.936009
## y 50.673762 51.505480
## 
## [[2]]
##         min       max
## x  2.525262  5.936009
## y 50.673762 51.505480
## 
## [[3]]
##         min       max
## x  2.525262  5.936009
## y 50.673762 51.505480
</code></pre>
<p>As expected for this WFS, the bounding boxes are the same for all
layers.</p>
<p>The final example shows how to get the abstract so we can read about the
contents of the layers.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_client$
  <span style="color:#0a0">getCapabilities</span>()$ 
  <span style="color:#0a0">getFeatureTypes</span>() %&gt;%  
  <span style="color:#0a0">map_chr</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getAbstract</span>()})
</code></pre></div><pre><code>## [1] &quot;Zone waaraan een biologische waarde gegeven wordt, alsook een aanduiding van het Natura 2000-habitattype, de vegetatiekundige eenheden of ecotopen, bodembedekking en gegevens over eventueel aanwezige kleine landschapselementen (BWK-karteringseenheden).&quot;                                                                                                                                                             
## [2] &quot;Op de Biologische Waarderingskaart krijgen een aantal gebieden een specifieke arcering omwille van de aanwezigheid van bepaalde fauna-elementen. De afbakening is gebaseerd op soorten die tot de Rode lijst-categorieën 'Met uitsterven bedreigd', 'Bedreigd' en 'Kwetsbaar' behoren. Een ruimere omschrijving wordt verstrekt in het afzonderlijk document per kaartblad \&quot;toelichtingXX\&quot;, met XX het kaartbladnummer.&quot;
## [3] &quot;Voorkomen van het Natura 2000 habitattype 3260, de submontane- en laaglandrivieren met waterranonkel- en fonteinkruidvegetaties.&quot;
</code></pre>
<h1 id="read-or-download-vector-data-from-wfs-getfeature">Read or download vector data from WFS: <code>GetFeature</code><a href="#read-or-download-vector-data-from-wfs-getfeature" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<h2 id="example-1-an-entire-layer">Example 1: an entire layer<a href="#example-1-an-entire-layer" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>The map of regions of Belgium.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">wfs_regions &lt;- <span style="color:#a50">&#34;https://eservices.minfin.fgov.be/arcgis/services/R2C/Regions/MapServer/WFSServer&#34;</span>
regions_client &lt;- WFSClient$<span style="color:#0a0">new</span>(wfs_regions, 
                            serviceVersion = <span style="color:#a50">&#34;2.0.0&#34;</span>)
regions_client$<span style="color:#0a0">getFeatureTypes</span>(pretty = <span style="color:#00a">TRUE</span>)
</code></pre></div><pre><code>##                  name   title
## 1 R2C_Regions:Regions Regions
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">url &lt;- <span style="color:#0a0">parse_url</span>(wfs_regions)
url$query &lt;- <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                  <span style="color:#aaa;font-style:italic">#version = &#34;2.0.0&#34;, # optional</span>
                  request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                  typename = <span style="color:#a50">&#34;regions&#34;</span>,
                  srsName = <span style="color:#a50">&#34;EPSG:4326&#34;</span>
                  )
request &lt;- <span style="color:#0a0">build_url</span>(url)

bel_regions &lt;- <span style="color:#0a0">read_sf</span>(request) <span style="color:#aaa;font-style:italic">#Lambert2008</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(bel_regions) +
  <span style="color:#0a0">geom_sf</span>()
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-17-1.png" alt=""><!-- --></p>
<h2 id="example-2-filter-by-attributes">Example 2: filter by attributes<a href="#example-2-filter-by-attributes" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>In this example, we only want to extract specific regions. This can be
done using either <a href="https://www.ogc.org/standards/filter">standard OGC filter
specification</a> or using a
<a href="https://portal.ogc.org/files/96288">Contextual Query Language (CQL)
filter</a>. The latter is currently a
draft proposal for an OGC standard and is subject to change. A
didactical explanation of CQL can be found
<a href="http://zing.z3950.org/cql/intro.html">here</a>.<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup> CQL currently only
works for WFS services that are hosted on a GeoServer!</p>
<p>In this example we also show how the previously used R code can be
stitched together using the pipe (<code>%&gt;%</code>) operator.</p>
<p><strong>Standard OGC filter</strong></p>
<p>Unfortunately, the standard OGC filter format is very verbose…</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">wfs_regions %&gt;%
  <span style="color:#0a0">parse_url</span>() %&gt;%
  <span style="color:#0a0">list_merge</span>(query = <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                          <span style="color:#aaa;font-style:italic">#version = &#34;2.0.0&#34;, # optional</span>
                          request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                          typename = <span style="color:#a50">&#34;regions&#34;</span>,
                          srsName = <span style="color:#a50">&#34;EPSG:4326&#34;</span>,
                          filter = <span style="color:#a50">&#34;&lt;Filter&gt;&lt;PropertyIsEqualTo&gt;&lt;PropertyName&gt;regions:NameDUT&lt;/PropertyName&gt;&lt;Literal&gt;&#39;Vlaams Gewest&#39;&lt;/Literal&gt;&lt;/PropertyIsEqualTo&gt;&lt;/Filter&gt;&#34;</span>)) %&gt;%
  <span style="color:#0a0">build_url</span>() %&gt;%
  <span style="color:#0a0">read_sf</span>() %&gt;%
  <span style="color:#0a0">ggplot</span>() +
  <span style="color:#0a0">geom_sf</span>()
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-18-1.png" alt=""><!-- --></p>
<p><strong>CQL filter</strong></p>
<p>We use a different WFS service for which CQL works. First we need to
know the names of the fields by which we can filter.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">wfs_vrbg &lt;- <span style="color:#a50">&#34;https://geo.api.vlaanderen.be/VRBG/wfs&#34;</span>

vrbg_client &lt;- WFSClient$<span style="color:#0a0">new</span>(wfs_vrbg, 
                            serviceVersion = <span style="color:#a50">&#34;1.1.0&#34;</span>)

vrbg_client$
  <span style="color:#0a0">getCapabilities</span>()$
  <span style="color:#0a0">findFeatureTypeByName</span>(<span style="color:#a50">&#34;VRBG:Refprv&#34;</span>)$
  <span style="color:#0a0">getDescription</span>() %&gt;%
  <span style="color:#0a0">map_chr</span>(<span style="color:#0a0">function</span>(x){x$<span style="color:#0a0">getName</span>()})
</code></pre></div><pre><code>## [1] &quot;UIDN&quot;    &quot;OIDN&quot;    &quot;TERRID&quot;  &quot;NAAM&quot;    &quot;NISCODE&quot; &quot;NUTS2&quot;   &quot;SHAPE&quot;
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#aaa;font-style:italic"># another way of doing this:</span>
wfs_vrbg %&gt;%
  <span style="color:#0a0">parse_url</span>() %&gt;%
  <span style="color:#0a0">list_merge</span>(query = <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                          <span style="color:#aaa;font-style:italic">#version = &#34;1.1.0&#34;, # optional</span>
                          request = <span style="color:#a50">&#34;DescribeFeatureType&#34;</span>,
                          typeName = <span style="color:#a50">&#34;VRBG:Refprv&#34;</span>)) %&gt;%
  <span style="color:#0a0">build_url</span>() %&gt;%
  <span style="color:#0a0">GET</span>()
</code></pre></div><pre><code>## Response [https://geo.api.vlaanderen.be/VRBG/wfs?service=wfs&amp;request=DescribeFeatureType&amp;typeName=VRBG%3ARefprv]
##   Date: 2023-08-31 06:04
##   Status: 200
##   Content-Type: text/xml; subtype=gml/3.2
##   Size: 1.53 kB
## &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&lt;xsd:schema xmlns:xsd=&quot;http://www.w3.or...
##   &lt;xsd:import namespace=&quot;http://www.opengis.net/gml/3.2&quot; schemaLocation=&quot;http...
##   &lt;xsd:complexType name=&quot;RefprvType&quot;&gt;
##     &lt;xsd:complexContent&gt;
##       &lt;xsd:extension base=&quot;gml:AbstractFeatureType&quot;&gt;
##         &lt;xsd:sequence&gt;
##           &lt;xsd:element maxOccurs=&quot;1&quot; minOccurs=&quot;1&quot; name=&quot;UIDN&quot; nillable=&quot;fals...
##           &lt;xsd:element maxOccurs=&quot;1&quot; minOccurs=&quot;1&quot; name=&quot;OIDN&quot; nillable=&quot;fals...
##           &lt;xsd:element maxOccurs=&quot;1&quot; minOccurs=&quot;0&quot; name=&quot;TERRID&quot; nillable=&quot;tr...
##           &lt;xsd:element maxOccurs=&quot;1&quot; minOccurs=&quot;0&quot; name=&quot;NAAM&quot; nillable=&quot;true...
## ...
</code></pre>
<p>The CQL filter format is much more human readable and easier to code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sf_prov &lt;- wfs_vrbg %&gt;% 
  <span style="color:#0a0">parse_url</span>() %&gt;% 
  <span style="color:#0a0">list_merge</span>(query = <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                          <span style="color:#aaa;font-style:italic">#version = &#34;1.1.0&#34;, # optional</span>
                          request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                          typeName = <span style="color:#a50">&#34;VRBG:Refprv&#34;</span>,
                          srsName = <span style="color:#a50">&#34;EPSG:31370&#34;</span>,
                          cql_filter=<span style="color:#a50">&#34;NAAM=&#39;West-Vlaanderen&#39;&#34;</span>)) %&gt;% 
  <span style="color:#0a0">build_url</span>() %&gt;% 
  <span style="color:#0a0">read_sf</span>(crs = <span style="color:#099">31370</span>)

sf_prov
</code></pre></div><pre><code>## Simple feature collection with 1 feature and 7 fields
## Geometry type: MULTISURFACE
## Dimension:     XY
## Bounding box:  xmin: 21991.63 ymin: 155928.6 xmax: 90410.78 ymax: 229724.6
## Projected CRS: BD72 / Belgian Lambert 72
## # A tibble: 1 × 8
##   gml_id    UIDN  OIDN TERRID NAAM       NISCODE NUTS2                     SHAPE
## * &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;        &lt;MULTISURFACE [m]&gt;
## 1 Refprv.3    20     3    351 West-Vlaa… 30000   BE25  (POLYGON ((80681.53 2276…
</code></pre>
<p>Also check out <a href="#example-5-extract-feature-data-at-particular-points">example
5</a> for a more
advanced use of the CQL filter.</p>
<p>Note, the rather exotic geometry type that is returned (<code>MULTISURFACE</code>).
Some <code>sf</code> functions, such as <code>st_buffer()</code>, will not work out of the box
for this type. In this specific case, we need an intermediate step
<code>st_cast(to = &quot;GEOMETRYCOLLECTION&quot;)</code> to make it work.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sf_prov %&gt;% 
  <span style="color:#0a0">st_buffer</span>(dist = <span style="color:#099">100</span>) <span style="color:#aaa;font-style:italic"># errors</span>
</code></pre></div><pre><code>## Error in scan(text = lst[[length(lst)]], quiet = TRUE): scan() expected 'a real', got 'ParseException:'

## Error in (function (msg) : ParseException: Unknown WKB type 12
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sf_prov_buffer &lt;- sf_prov %&gt;% 
  <span style="color:#0a0">st_cast</span>(to = <span style="color:#a50">&#34;GEOMETRYCOLLECTION&#34;</span>) %&gt;% 
  <span style="color:#0a0">st_buffer</span>(dist = <span style="color:#099">10000</span>) <span style="color:#aaa;font-style:italic"># works</span>

sf_prov %&gt;% 
  <span style="color:#0a0">ggplot</span>() + 
  <span style="color:#0a0">geom_sf</span>(data = sf_prov_buffer) +
  <span style="color:#0a0">geom_sf</span>()
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-21-1.png" alt=""><!-- --></p>
<p>If you need to further convert to geometry type <code>POLYGON</code>, then use
<code>st_collection_extract()</code> to extract the Polygon from the
GeometryCollection:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sf_prov %&gt;% 
  <span style="color:#0a0">st_cast</span>(to = <span style="color:#a50">&#34;GEOMETRYCOLLECTION&#34;</span>) %&gt;% 
  <span style="color:#0a0">st_collection_extract</span>(type = <span style="color:#a50">&#34;POLYGON&#34;</span>)
</code></pre></div><pre><code>## Simple feature collection with 1 feature and 7 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: 21991.63 ymin: 155928.6 xmax: 90410.78 ymax: 229724.6
## Projected CRS: BD72 / Belgian Lambert 72
## # A tibble: 1 × 8
##   gml_id    UIDN  OIDN TERRID NAAM       NISCODE NUTS2                     SHAPE
##   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;             &lt;POLYGON [m]&gt;
## 1 Refprv.3    20     3    351 West-Vlaa… 30000   BE25  ((80681.53 227626.5, 807…
</code></pre>
<p>More generally however, if a row of the <code>MULTISURFACE</code> object
corresponds to either a <code>MULTIPOLYGON</code> (collection of polygons) or a
<code>POLYGON</code> with holes, with the above
<code>st_collection_extract(type = &quot;POLYGON&quot;)</code> this row will be repeated for
all constituting polygons. This results in too many features. It can be
solved as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#aaa;font-style:italic"># to demonstrate, we first create an sf object of several MULTISURFACE features:</span>
sf_prov_all &lt;- 
  wfs_vrbg %&gt;% 
  <span style="color:#0a0">parse_url</span>() %&gt;% 
  <span style="color:#0a0">list_merge</span>(query = <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                          request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                          typeName = <span style="color:#a50">&#34;VRBG:Refprv&#34;</span>,
                          srsName = <span style="color:#a50">&#34;EPSG:31370&#34;</span>)) %&gt;% 
  <span style="color:#0a0">build_url</span>() %&gt;% 
  <span style="color:#0a0">read_sf</span>(crs = <span style="color:#099">31370</span>)

<span style="color:#aaa;font-style:italic"># converting:</span>
sf_prov_all %&gt;%  <span style="color:#aaa;font-style:italic"># 5 MULTISURFACE features</span>
  <span style="color:#0a0">st_cast</span>(<span style="color:#a50">&#34;GEOMETRYCOLLECTION&#34;</span>) %&gt;%
  <span style="color:#0a0">mutate</span>(id = <span style="color:#0a0">seq_len</span>(<span style="color:#0a0">nrow</span>(.))) %&gt;%
  <span style="color:#0a0">st_collection_extract</span>(<span style="color:#a50">&#34;POLYGON&#34;</span>) %&gt;% <span style="color:#aaa;font-style:italic"># 28 POLYGON features</span>
  <span style="color:#0a0">aggregate</span>(<span style="color:#0a0">list</span>(.$id), first, do_union = <span style="color:#00a">FALSE</span>) %&gt;% <span style="color:#aaa;font-style:italic"># 5 MULTIPOLYGON features</span>
  <span style="color:#0a0">select</span>(-id, -Group.1) %&gt;%
  as_tibble %&gt;%
  st_as_sf
</code></pre></div><pre><code>## Simple feature collection with 5 features and 7 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 21991.63 ymin: 153058.3 xmax: 258871.8 ymax: 244027.2
## Projected CRS: BD72 / Belgian Lambert 72
## # A tibble: 5 × 8
##   gml_id    UIDN  OIDN TERRID NAAM       NISCODE NUTS2                  geometry
##   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;        &lt;MULTIPOLYGON [m]&gt;
## 1 Refprv.1    18     2    357 Antwerpen  10000   BE21  (((178136.3 244009.2, 17…
## 2 Refprv.2    19     4    359 Vlaams Br… 20001   BE24  (((200484.9 193541, 2004…
## 3 Refprv.3    20     3    351 West-Vlaa… 30000   BE25  (((80681.53 227626.5, 80…
## 4 Refprv.4    21     1    355 Limburg    70000   BE22  (((231494.3 219142.5, 23…
## 5 Refprv.5    22     5    356 Oost-Vlaa… 40000   BE23  (((145735.2 220358.3, 14…
</code></pre>
<h2 id="example-3-restrict-to-a-bounding-box">Example 3: restrict to a bounding box<a href="#example-3-restrict-to-a-bounding-box" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>This examples illustrates how you can read or download information from
a WFS for further use in R.</p>
<p>Let’s start by reading in the “BWK:Bwkhab” layer for the Hallerbos area.</p>
<p>The main part is defining the input and output. We store the data in
<a href="https://en.wikipedia.org/wiki/GeoJSON">GeoJSON</a> format which is an open
standard format designed for representing simple geographical features,
along with their non-spatial attributes. It is based on JSON, the
JavaScript Object Notation.</p>
<p>We also add the bounding box from which we want to retrieve the data.
This is very important to add. If you omit a bounding box, the service
will return the entire map which can be very large.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">url &lt;- <span style="color:#0a0">parse_url</span>(wfs_bwk)
url$query &lt;- <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;WFS&#34;</span>,
                  <span style="color:#aaa;font-style:italic">#version = &#34;2.0.0&#34;, # optional</span>
                  request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                  typename = <span style="color:#a50">&#34;BWK:Bwkhab&#34;</span>,
                  bbox = <span style="color:#a50">&#34;142600,153800,146000,156900&#34;</span>)
request &lt;- <span style="color:#0a0">build_url</span>(url)
</code></pre></div><p>Let’s check what we are about to read with <code>sf::st_layers()</code>. This time,
the function does return useful information, but the layer name
BWK:Bwkhab seems to be overwritten.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">st_layers</span>(request)
</code></pre></div><pre><code>## Driver: GML 
## Available layers:
##   layer_name geometry_type features fields                  crs_name
## 1     Bwkhab Curve Polygon      670     32 BD72 / Belgian Lambert 72
</code></pre>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_hallerbos &lt;- <span style="color:#0a0">read_sf</span>(request)
</code></pre></div><p>Note that the <code>layer = ...</code> argument of <code>sf:read_sf()</code> cannot be used to
specify the layer when you pass a WFS GetFeature request to the
function.</p>
<p>Let’s make a simple plot of the object. Note that the object contains
features outside of the bounding box. Those are features which have only
some part within the bounding box.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(bwk_hallerbos) + 
  <span style="color:#0a0">geom_sf</span>()
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-27-1.png" alt=""><!-- --></p>
<p>You can use <code>sf::st_write()</code> to save this layer in any format that is
listed by <code>sf::st_drivers()</code>.</p>
<h2 id="example-4-downloading-data-to-disk">Example 4: downloading data to disk<a href="#example-4-downloading-data-to-disk" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>Continuing from the previous example, we can download the data with
<code>httr::GET</code> and <code>httr::write_disk()</code>. The only difference is that we add
<code>outputFormat</code> to the request. In this way we can deviate from the
default output format and choose the output format we like.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">url &lt;- <span style="color:#0a0">parse_url</span>(wfs_bwk)
url$query &lt;- <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;WFS&#34;</span>,
                  <span style="color:#aaa;font-style:italic">#version = &#34;2.0.0&#34;, # optional</span>
                  request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                  typename = <span style="color:#a50">&#34;BWK:Bwkhab&#34;</span>,
                  bbox = <span style="color:#a50">&#34;142600,153800,146000,156900&#34;</span>,
                  outputFormat = <span style="color:#a50">&#34;application/json&#34;</span>)
request &lt;- <span style="color:#0a0">build_url</span>(url)
</code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">file &lt;- <span style="color:#0a0">tempfile</span>(fileext = <span style="color:#a50">&#34;.geojson&#34;</span>)
<span style="color:#0a0">GET</span>(url = request, 
    <span style="color:#0a0">write_disk</span>(file))
</code></pre></div><pre><code>## Response [https://geo.api.vlaanderen.be/BWK/wfs?service=WFS&amp;request=GetFeature&amp;typename=BWK%3ABwkhab&amp;bbox=142600%2C153800%2C146000%2C156900&amp;outputFormat=application%2Fjson]
##   Date: 2023-08-31 06:04
##   Status: 200
##   Content-Type: application/json;charset=UTF-8
##   Size: 859 kB
## &lt;ON DISK&gt;  C:\Users\HANS_V~1\AppData\Local\Temp\RtmpIVvgfZ\filebd827562159.geojson
</code></pre>
<p>At this point, all features are downloaded and can be used in R as we
would with any other local file. So we need to load the file with
<code>read_sf()</code> from <code>sf</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">bwk_hallerbos2 &lt;- <span style="color:#0a0">read_sf</span>(file)
</code></pre></div><p>Downloading data could be important for reproducible workflows (e.g. by
using the downloaded data as the ‘real’ starting point and distribute
it).</p>
<h2 id="example-5-extract-feature-data-at-particular-points">Example 5: extract feature data at particular points<a href="#example-5-extract-feature-data-at-particular-points" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>In some situations, we do not need the spatial features (polygons,
lines, points), but are interested in the data at a particular point
(i.e. attribute table data) of the spatial feature. When working in a
local GIS environment, one would use a spatial operator to extract the
data (e.g. <code>within</code>, <code>intersects</code>, <code>contains</code>,…). As we discussed
earlier, WFS supports certain spatial operators as part of the service
to directly query this data and overcomes the need to download the
spatial feature data first.</p>
<p>Consider the following use case: You want to extract the attribute data
from a <a href="http://www.geopunt.be/catalogus/datasetfolder/5c129f2d-4498-4bc3-8860-01cb2d513f8f">soil
map</a>
for a number of sampling points (point coordinates). This use case can
be tackled by relying on the WFS service and the affiliated spatial
operators.</p>
<p>Our example data point (in Lambert 72):</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">x_lam &lt;- <span style="color:#099">173995.67</span>
y_lam &lt;- <span style="color:#099">212093.44</span>
</code></pre></div><p>From this point we know the data, so we can verify the result (in
Dutch):</p>
<ul>
<li>Bodemtype: s-Pgp3(v)</li>
<li>Bodemserie: Pgp</li>
<li>Textuurklasse: licht zandleem</li>
<li>Drainageklasse: uiterst nat, gereduceerd</li>
</ul>
<p>Hence, we now want to extract these soil properties from the WFS, for
the coordinates defined above.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">properties_of_interest &lt;- <span style="color:#0a0">c</span>(<span style="color:#a50">&#34;Drainageklasse&#34;</span>,
                            <span style="color:#a50">&#34;Textuurklasse&#34;</span>,
                            <span style="color:#a50">&#34;Bodemserie&#34;</span>,
                            <span style="color:#a50">&#34;Bodemtype&#34;</span>)
</code></pre></div><p>The URL of the wfs service of the soil map of the Flemish region:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">wfs_bodemtypes &lt;- <span style="color:#a50">&#34;https://www.dov.vlaanderen.be/geoserver/bodemkaart/bodemtypes/wfs&#34;</span>
</code></pre></div><p>The essential part is to set up the proper query! The required data for
the service is defined in the
<a href="https://www.dov.vlaanderen.be/geoserver/bodemkaart/bodemtypes/wfs?version=1.1.0&amp;request=GetCapabilities&amp;service=wfs">metadata</a>
description. This can look a bit overwhelming at the start, but is a
matter of looking for some specific elements of the (XML) document:</p>
<ul>
<li><code>service</code> (WFS) and <code>request</code> (GetFeature) are mandatory fields (see
below); <code>version</code> (1.1.0) is optional</li>
<li><code>typeName</code>: Look at the different <code>&lt;FeatureType...</code> enlisted and pick
the <code>&lt;Name&gt;</code> of the one you’re interested in. In this particular case
<code>bodemkaart:bodemtypes</code> is the only one available.</li>
<li><code>outputFormat</code>: The supported output formats are enlisted in
<code>&lt;ows:Parameter name=&quot;outputFormat&quot;&gt;</code>. As the service provides CSV as
output, this is a straightforward option. <code>json</code> is another popular
one.</li>
<li><code>propertyname</code>: A list of the attribute table fields (cfr. supra). A
full list of the Flanders soil map is provided
<a href="https://www.dov.vlaanderen.be/geoserver/bodemkaart/bodemtypes/wfs?request=DescribeFeatureType">here</a>.</li>
<li>We also define the <code>CRS</code>, using the <a href="http://spatialreference.org/">EPSG
code</a>.</li>
<li><code>CQL_FILTER</code>: Define the spatial operator, in this case <code>INTERSECTS</code>
of the WFS <code>geom</code> and our <code>POINT</code> coordinate. The operators are
enlisted in the <code>&lt;ogc:SpatialOperators&gt;</code> field. Note that <code>geom</code> is
the name of the geometry field (in this example <code>geom</code> but other web
services may use a different name such as <code>SHAPE</code>, <code>geometry</code> or
<code>the_geom</code>).</li>
</ul>
<p>Formatting all this information in a query and executing the request
(<code>GET</code>) towards the service:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">query &lt;- <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;WFS&#34;</span>,
             request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
             <span style="color:#aaa;font-style:italic">#version = &#34;1.1.0&#34;, # optional</span>
             typeName = <span style="color:#a50">&#34;bodemkaart:bodemtypes&#34;</span>,
             outputFormat = <span style="color:#a50">&#34;csv&#34;</span>,
             propertyname = <span style="color:#0a0">as.character</span>(<span style="color:#0a0">paste</span>(properties_of_interest,
                                               collapse = <span style="color:#a50">&#34;,&#34;</span>)),
             CRS = <span style="color:#a50">&#34;EPSG:31370&#34;</span>,
             CQL_FILTER = <span style="color:#0a0">sprintf</span>(<span style="color:#a50">&#34;INTERSECTS(geom,POINT(%s %s))&#34;</span>,
                                  x_lam, y_lam)) 
result &lt;- <span style="color:#0a0">GET</span>(wfs_bodemtypes, query = query)
result
</code></pre></div><pre><code>## Response [https://www.dov.vlaanderen.be/geoserver/bodemkaart/bodemtypes/wfs?service=WFS&amp;request=GetFeature&amp;typeName=bodemkaart%3Abodemtypes&amp;outputFormat=csv&amp;propertyname=Drainageklasse%2CTextuurklasse%2CBodemserie%2CBodemtype&amp;CRS=EPSG%3A31370&amp;CQL_FILTER=INTERSECTS%28geom%2CPOINT%28173995.67%20212093.44%29%29]
##   Date: 2022-03-15 08:07
##   Status: 200
##   Content-Type: text/csv;charset=UTF-8
##   Size: 129 B
## FID,Bodemtype,Bodemserie,Textuurklasse,Drainageklasse
## bodemtypes.72727,s-Pgp3(v),Pgp,licht zandleem,&quot;uiterst nat, gereduceerd&quot;
</code></pre>
<p>The result is not yet formatted to be used as a dataframe. We need to
use a small <em>trick</em> using the <code>textConnection</code> function to get from the
result (bits) towards a readable output in a dataframe:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">df &lt;- <span style="color:#0a0">read.csv</span>(<span style="color:#0a0">textConnection</span>(<span style="color:#0a0">content</span>(result, <span style="color:#a50">&#39;text&#39;</span>)))
knitr::<span style="color:#0a0">kable</span>(df)
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">FID</th>
<th style="text-align:left">Bodemtype</th>
<th style="text-align:left">Bodemserie</th>
<th style="text-align:left">Textuurklasse</th>
<th style="text-align:left">Drainageklasse</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">bodemtypes.72727</td>
<td style="text-align:left">s-Pgp3(v)</td>
<td style="text-align:left">Pgp</td>
<td style="text-align:left">licht zandleem</td>
<td style="text-align:left">uiterst nat, gereduceerd</td>
</tr>
</tbody>
</table>
<p>Which indeed corresponds to the data of the coordinate.</p>
<p>In order to make your coding work lighter, you can easily put the WFS R
code (building the WFS request and retrieving its results) inside a
function. Just use <a href="https://github.com/inbo/inborutils/blob/8dad1ebe25ba80a3239d4a1ab9e918cf862b621e/R/extract_soil_map_data.R#L49-L91">the
code</a>
of the <code>inborutils::extract_soil_map_data()</code> function (documented
<a href="https://inbo.github.io/inborutils/reference/extract_soil_map_data.html">here</a>)
as a template for your own function.</p>
<p>Now this function makes it really easy to request the data:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">library</span>(inborutils)
<span style="color:#0a0">extract_soil_map_data</span>(
  x_lam = x_lam, 
  y_lam = y_lam) %&gt;%
  knitr::<span style="color:#0a0">kable</span>()
</code></pre></div><pre><code>## Defaulting to Bodemserie, Unibodemtype, Bodemtype. To avoid this message provide properties of interest in the function call.
</code></pre>
<table>
<thead>
<tr>
<th style="text-align:left">Bodemtype</th>
<th style="text-align:left">Unibodemtype</th>
<th style="text-align:left">Bodemserie</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">s-Pgp3(v)</td>
<td style="text-align:left">s-Pgp3(v)</td>
<td style="text-align:left">Pgp</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">extract_soil_map_data</span>(
  x_lam = x_lam, 
  y_lam = y_lam,
  properties_of_interest = <span style="color:#0a0">c</span>(<span style="color:#a50">&#34;Eenduidige_legende&#34;</span>, <span style="color:#a50">&#34;Textuurklasse&#34;</span>)) %&gt;%
  knitr::<span style="color:#0a0">kable</span>()
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">Textuurklasse</th>
<th style="text-align:left">Eenduidige_legende</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">licht zandleem</td>
<td style="text-align:left">De twee bovenvermelde grondwatergronden op licht zandleem (Pgp en Pgg) zijn permanent zeer nat. Ze zijn overstroomd in de winter en hebben een zomerwaterstand op ongeveer 40 cm. Ze zijn ongeschikt voor landbouw; zelfs weiden geven geen bevredigende resultaten. Deze bodems zijn dus ongeschikt voor uitbating; eventueel kunnen populieren, mits de nodige ontwatering, aangepast worden, de resultaten zijn echter weinig gunstig.</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">extract_soil_map_data</span>(
  x_lam = x_lam, 
  y_lam = y_lam,
  properties_of_interest = properties_of_interest) %&gt;%
  knitr::<span style="color:#0a0">kable</span>()
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">Bodemtype</th>
<th style="text-align:left">Bodemserie</th>
<th style="text-align:left">Textuurklasse</th>
<th style="text-align:left">Drainageklasse</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">s-Pgp3(v)</td>
<td style="text-align:left">Pgp</td>
<td style="text-align:left">licht zandleem</td>
<td style="text-align:left">uiterst nat, gereduceerd</td>
</tr>
</tbody>
</table>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#aaa;font-style:italic"># multiple point locations</span>
xy &lt;- <span style="color:#0a0">data.frame</span>(id = <span style="color:#0a0">c</span>(<span style="color:#a50">&#34;loc1&#34;</span>, <span style="color:#a50">&#34;loc2&#34;</span>),
                 x = <span style="color:#0a0">c</span>(<span style="color:#099">173995.67</span>, <span style="color:#099">180000</span>),
                 y = <span style="color:#0a0">c</span>(<span style="color:#099">212093.4</span>, <span style="color:#099">212000</span>))

xy %&gt;%
  <span style="color:#0a0">group_by</span>(id) %&gt;%
  <span style="color:#0a0">summarise</span>(<span style="color:#0a0">extract_soil_map_data</span>(x, y, 
                                  properties_of_interest = properties_of_interest)) %&gt;%
  knitr::<span style="color:#0a0">kable</span>()
</code></pre></div><table>
<thead>
<tr>
<th style="text-align:left">id</th>
<th style="text-align:left">Bodemtype</th>
<th style="text-align:left">Bodemserie</th>
<th style="text-align:left">Textuurklasse</th>
<th style="text-align:left">Drainageklasse</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">loc1</td>
<td style="text-align:left">s-Pgp3(v)</td>
<td style="text-align:left">Pgp</td>
<td style="text-align:left">licht zandleem</td>
<td style="text-align:left">uiterst nat, gereduceerd</td>
</tr>
<tr>
<td style="text-align:left">loc2</td>
<td style="text-align:left">Sdg</td>
<td style="text-align:left">Sdg</td>
<td style="text-align:left">lemig zand</td>
<td style="text-align:left">matig nat, matig gleyig</td>
</tr>
</tbody>
</table>
<h2 id="example-6-pagination">Example 6: pagination<a href="#example-6-pagination" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<p>When a layer of a WFS service contains many thousands of features, often
the WFS service will restrict the number of features that can be
obtained with one request. This is done to optimize performance
(responsiveness) of the WFS service: it is more efficient to transfer
small packages of data and this is even more the case when multiple user
requests are transmitted concurrently to the service.</p>
<p>In this example we show how to deal with this situation. A technique
called ‘pagination’ can be used to obtain all features one is interested
in by sending multiple requests to the server. The service is available
from version ‘2.0.0’ onwards. Servers running older versions may or may
not have support for ‘pagination’.</p>
<p>We will use the ‘Watervlakken’ WFS service for this example.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#aaa;font-style:italic"># this layer returns just 1000 features (for performance reasons)</span>
wfs &lt;- <span style="color:#a50">&#34;https://gisservices.inbo.be/arcgis/services/Watervlakken/MapServer/WFSServer?&#34;</span>
url &lt;- <span style="color:#0a0">parse_url</span>(wfs)
url$query &lt;- <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                  version = <span style="color:#a50">&#34;2.0.0&#34;</span>, <span style="color:#aaa;font-style:italic"># facultative</span>
                  request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                  typename = <span style="color:#a50">&#34;Watervlakken:Watervlakken&#34;</span>,
                  srsName = <span style="color:#a50">&#34;EPSG:31370&#34;</span>
)
request &lt;- <span style="color:#0a0">build_url</span>(url)
gd &lt;- <span style="color:#0a0">read_sf</span>(request)
gd
</code></pre></div><pre><code>## Simple feature collection with 1000 features and 12 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 136507.8 ymin: 187356 xmax: 192040.7 ymax: 237604.4
## Projected CRS: Belge 1972 / Belgian Lambert 72
## # A tibble: 1,000 x 13
##    gml_id      OBJECTID WVLC  NAAM  OPPWVL OMTWVL SHAPE_Length SHAPE_Area DIEPKL
##    &lt;chr&gt;          &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; 
##  1 Watervlakk~        1 ANTB~ Zwal~   111.   52.9         52.9       111. &lt;NA&gt;  
##  2 Watervlakk~        2 ANTB~ &lt;NA&gt;   1679.  165.         165.       1679. &lt;NA&gt;  
##  3 Watervlakk~        3 ANTB~ &lt;NA&gt;   2634.  232.         232.       2634. &lt;NA&gt;  
##  4 Watervlakk~        4 ANTB~ &lt;NA&gt;    525.  156.         156.        525. &lt;NA&gt;  
##  5 Watervlakk~        5 ANTB~ &lt;NA&gt;    409.   80.0         80.0       409. &lt;NA&gt;  
##  6 Watervlakk~        6 ANTB~ &lt;NA&gt;    663.  121.         121.        663. &lt;NA&gt;  
##  7 Watervlakk~        7 ANTB~ &lt;NA&gt;   2402.  269.         269.       2402. &lt;NA&gt;  
##  8 Watervlakk~        8 ANTB~ &lt;NA&gt;   3940.  274.         274.       3940. &lt;NA&gt;  
##  9 Watervlakk~        9 ANTB~ &lt;NA&gt;    146.   46.2         46.2       146. &lt;NA&gt;  
## 10 Watervlakk~       10 ANTB~ &lt;NA&gt;   3402.  251.         251.       3402. &lt;NA&gt;  
## # ... with 990 more rows, and 4 more variables: GEBIED &lt;chr&gt;, HYLAC &lt;int&gt;,
## #   WTRLICHC &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;
</code></pre>
<p>As we can see from the output, only 1000 features are returned.</p>
<p>To know in advance how many features the WFS has in total, you can add
<code>resultType=&quot;hits&quot;</code> to the query:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">url$query &lt;- <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                  version = <span style="color:#a50">&#34;2.0.0&#34;</span>, <span style="color:#aaa;font-style:italic"># facultative</span>
                  request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                  typename = <span style="color:#a50">&#34;Watervlakken:Watervlakken&#34;</span>,
                  srsName = <span style="color:#a50">&#34;EPSG:31370&#34;</span>,
                  resultType = <span style="color:#a50">&#34;hits&#34;</span>
)
request &lt;- <span style="color:#0a0">build_url</span>(url)
result &lt;- <span style="color:#0a0">GET</span>(request)
parsed &lt;- xml2::<span style="color:#0a0">as_list</span>(<span style="color:#0a0">content</span>(result, <span style="color:#a50">&#34;parsed&#34;</span>))
n_features &lt;- <span style="color:#0a0">attr</span>(parsed$FeatureCollection, <span style="color:#a50">&#34;numberMatched&#34;</span>)
n_features
</code></pre></div><pre><code>## [1] &quot;88713&quot;
</code></pre>
<p>We see that there are 88713 features. In the next chunk we show how
<code>startIndex</code> and <code>count</code> can be used together to obtain more features
(3000 in the example).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#aaa;font-style:italic"># use count and startIndex to return more features (pagination)</span>
get_watervlakken &lt;- <span style="color:#0a0">function</span>(index = <span style="color:#099">0</span>) {
  wfs &lt;- <span style="color:#a50">&#34;https://gisservices.inbo.be/arcgis/services/Watervlakken/MapServer/WFSServer?&#34;</span>
  request &lt;- <span style="color:#0a0">build_url</span>(url)
  request <span style="color:#aaa;font-style:italic"># url in browser bekeken en nodige info in opgezocht</span>
  url$query &lt;- <span style="color:#0a0">list</span>(service = <span style="color:#a50">&#34;wfs&#34;</span>,
                    version = <span style="color:#a50">&#34;2.0.0&#34;</span>, <span style="color:#aaa;font-style:italic"># facultative</span>
                    request = <span style="color:#a50">&#34;GetFeature&#34;</span>,
                    typename = <span style="color:#a50">&#34;Watervlakken:Watervlakken&#34;</span>,
                    srsName = <span style="color:#a50">&#34;EPSG:31370&#34;</span>,
                    startIndex=index,
                    count=<span style="color:#099">1000</span>)
  request &lt;- <span style="color:#0a0">build_url</span>(url)
  gd &lt;- <span style="color:#0a0">read_sf</span>(request)
  <span style="color:#0a0">return</span>(gd)
}

gd &lt;- <span style="color:#0a0">map_dfr</span>(.x = <span style="color:#0a0">seq</span>(<span style="color:#099">0</span>, <span style="color:#099">2000</span>, <span style="color:#099">1000</span>),
              .f = get_watervlakken
        )

gd
</code></pre></div><pre><code>## Simple feature collection with 3000 features and 14 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 136507.8 ymin: 187156.5 xmax: 192040.7 ymax: 237604.4
## Projected CRS: Belge 1972 / Belgian Lambert 72
## # A tibble: 3,000 x 15
##    gml_id      OBJECTID WVLC  NAAM  OPPWVL OMTWVL SHAPE_Length SHAPE_Area DIEPKL
##  * &lt;chr&gt;          &lt;int&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt; 
##  1 Watervlakk~        1 ANTB~ Zwal~   111.   52.9         52.9       111. &lt;NA&gt;  
##  2 Watervlakk~        2 ANTB~ &lt;NA&gt;   1679.  165.         165.       1679. &lt;NA&gt;  
##  3 Watervlakk~        3 ANTB~ &lt;NA&gt;   2634.  232.         232.       2634. &lt;NA&gt;  
##  4 Watervlakk~        4 ANTB~ &lt;NA&gt;    525.  156.         156.        525. &lt;NA&gt;  
##  5 Watervlakk~        5 ANTB~ &lt;NA&gt;    409.   80.0         80.0       409. &lt;NA&gt;  
##  6 Watervlakk~        6 ANTB~ &lt;NA&gt;    663.  121.         121.        663. &lt;NA&gt;  
##  7 Watervlakk~        7 ANTB~ &lt;NA&gt;   2402.  269.         269.       2402. &lt;NA&gt;  
##  8 Watervlakk~        8 ANTB~ &lt;NA&gt;   3940.  274.         274.       3940. &lt;NA&gt;  
##  9 Watervlakk~        9 ANTB~ &lt;NA&gt;    146.   46.2         46.2       146. &lt;NA&gt;  
## 10 Watervlakk~       10 ANTB~ &lt;NA&gt;   3402.  251.         251.       3402. &lt;NA&gt;  
## # ... with 2,990 more rows, and 6 more variables: GEBIED &lt;chr&gt;, HYLAC &lt;int&gt;,
## #   WTRLICHC &lt;chr&gt;, geometry &lt;MULTIPOLYGON [m]&gt;, CONNECT &lt;chr&gt;,
## #   PEILBEHEER &lt;chr&gt;
</code></pre>
<p>Whether it is a good idea or not to request many thousands of features
from a WFS really depends on what our further plans are with the spatial
data.</p>
<p>Do we really need the attribute data? If not, and the only goal is
visualization, we should have used a WMS (Web Mapping Service) instead
(see <a href="https://inbo.github.io/tutorials/tutorials/spatial_wms_services/">this
tutorial</a>).</p>
<p>Do we need all data from the WFS? We need to think carefully which
features and which attributes are really needed for whatever use case we
might have. When we have a clear idea which subset of the data we need,
we can apply what we have learned in the examples in this tutorial to
restrict the request to what we need.</p>
<p>If we find ourselves in the case where we think we really need to
request many, many features from a WFS service, it may also be more
advised to use a download service instead of a WFS (search) service.</p>
<h1 id="references">References<a href="#references" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-lovelace_geocomputation_2020" class="csl-entry">
<p>Lovelace, Robin, Jakub Nowosad, and Jannes Muenchow. 2020.
<em>Geocomputation with R</em>. <a href="https://geocompr.robinlovelace.net">https://geocompr.robinlovelace.net</a>.</p>
</div>
</div>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Note that CQL was formerly called Common Query Language.&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='categories'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>
<span class='screen-reader-text'>Categories: </span><a class='category' href='/categories/r/'>r</a></div>
<div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tags/gis/'>gis</a>, <a class='tag' href='/tags/webservice/'>webservice</a>, <a class='tag' href='/tags/r/'>r</a>, <a class='tag' href='/tags/maps/'>maps</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/tutorials/git_zenodo/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Set up Zenodo - GitHub integration</a>
    </div><div class='next-entry sep-before'>
      <a href='/tutorials/r_brms/'>
        <span class='screen-reader-text'>Next post: </span>Tutorial Bayesian statistics with brms<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p><a href="http://creativecommons.org/licenses/by/4.0/"><img src="https://inbo.github.io/tutorials/images/cc-by.svg" alt="CC BY 4.0"></a> &copy; 2018-2025 Research Institute for Nature and Forest (INBO) </p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__assets_js_src="/assets/js/"</script>

<script src='/assets/js/main.c3bcf2df.js'></script><script src='/js/custom.js'></script>

</body>

</html>

