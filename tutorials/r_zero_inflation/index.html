<!DOCTYPE html>
<html lang='en'><head>
  <meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'>
<meta name='description' content='Various ways in which zero-inflation can be detected and handled.'>
<meta name='theme-color' content='#c04384'>

<meta property='og:title' content='Zero-inflation • Thierry Onkelinx'>
<meta property='og:description' content='Various ways in which zero-inflation can be detected and handled.'>
<meta property='og:url' content='https://inbo.github.io/tutorials/tutorials/r_zero_inflation/'>
<meta property='og:site_name' content='INBO Tutorials'>
<meta property='og:type' content='article'><meta property='article:section' content='tutorials'><meta property='article:tag' content='r'><meta property='article:tag' content='analysis'><meta property='article:tag' content='mixed model'><meta property='article:published_time' content='2020-07-01T00:00:00Z'/><meta property='article:modified_time' content='2020-07-01T00:00:00Z'/><meta name='twitter:card' content='summary'>

<meta name="generator" content="Hugo 0.62.2" />

  <title>Zero-inflation • Thierry Onkelinx</title>
  <link rel='canonical' href='https://inbo.github.io/tutorials/tutorials/r_zero_inflation/'>
  
  
  <link rel='icon' href='/tutorials/favicon.ico'>
<link rel='stylesheet' href='/tutorials/assets/css/main.dd2efce5.css'><link rel='stylesheet' href='/tutorials/css/custom.css'><style>
:root{--color-accent:#c04384;}
</style>

  

</head>
<body class='page type-tutorials has-sidebar'>

  <div class='site'><div id='sidebar' class='sidebar'>
  <a class='screen-reader-text' href='#main-menu'>Skip to Main Menu</a>

  <div class='container'><section class='widget widget-about sep-after'>
  <header>
    
    <div class='logo'>
      <a href='/tutorials/'>
        <img src='/tutorials/images/logo.png'>
      </a>
    </div>
    
    <h2 class='title site-title '>
     
    </h2>
    <div class='desc'>
    
    </div>
  </header>

</section>
<section class='widget widget-search sep-after'>
  <header>
    <h4 class='title widget-title'> </h4>
  </header>

  <form action='/tutorials/search' id='search-form' class='search-form'>
    <label>
      <span class='screen-reader-text'>Search</span>
      <input id='search-term' class='search-term' type='search' name='q' placeholder='Search&hellip;'>
    </label></form>

</section>
<section class='widget widget-sidebar_menu sep-after'><nav id='sidebar-menu' class='menu sidebar-menu' aria-label='Sidebar Menu'>
    <div class='container'>
      <ul><li class='item'>
  <a href='/tutorials/'>Home</a></li><li class='item'>
  <a href='/tutorials/articles/'>Articles</a></li><li class='item'>
  <a href='/tutorials/tutorials/'>Tutorials</a></li><li class='item'>
  <a href='/tutorials/create_tutorial/'>Create tutorial</a></li><li class='item has-children'>
  <a href='/tutorials/installation/'>Installation</a><button class='sub-menu-toggler'>
    <span class='screen-reader-text'>expand sub menu</span>
    <span class='sign'></span>
  </button>

  <ul class='sub-menu'><li class='item'>
  <a href='/tutorials/installation/administrator/'>For admins</a></li><li class='item'>
  <a href='/tutorials/installation/user/'>For users</a></li></ul></li><li class='item'>
  <a href='/tutorials/categories/'>Categories</a></li><li class='item'>
  <a href='https://github.com/inbo/tutorials'>Repository</a></li></ul>
    </div>
  </nav>

</section><section class='widget widget-taxonomy_cloud sep-after'>
  <header>
    <h4 class='title widget-title'>Tags</h4>
  </header>

  <div class='container list-container'>
  <ul class='list taxonomy-cloud no-shuffle'><li>
        <a href='/tutorials/tags/analysis/' style='font-size:1.1142857142857143em'>analysis</a>
      </li><li>
        <a href='/tutorials/tags/analysis-of-variance/' style='font-size:1em'>analysis of variance</a>
      </li><li>
        <a href='/tutorials/tags/api/' style='font-size:1em'>api</a>
      </li><li>
        <a href='/tutorials/tags/bibliography/' style='font-size:1em'>bibliography</a>
      </li><li>
        <a href='/tutorials/tags/biodiversity/' style='font-size:1em'>biodiversity</a>
      </li><li>
        <a href='/tutorials/tags/bookdown/' style='font-size:1em'>bookdown</a>
      </li><li>
        <a href='/tutorials/tags/ci/' style='font-size:1.0285714285714285em'>ci</a>
      </li><li>
        <a href='/tutorials/tags/coding-club/' style='font-size:1em'>coding club</a>
      </li><li>
        <a href='/tutorials/tags/csl/' style='font-size:1em'>csl</a>
      </li><li>
        <a href='/tutorials/tags/data/' style='font-size:1.0571428571428572em'>data</a>
      </li><li>
        <a href='/tutorials/tags/database/' style='font-size:1.1142857142857143em'>database</a>
      </li><li>
        <a href='/tutorials/tags/development/' style='font-size:1.0285714285714285em'>development</a>
      </li><li>
        <a href='/tutorials/tags/dplyr/' style='font-size:1em'>dplyr</a>
      </li><li>
        <a href='/tutorials/tags/e-book/' style='font-size:1em'>e-book</a>
      </li><li>
        <a href='/tutorials/tags/effectclass/' style='font-size:1em'>effectclass</a>
      </li><li>
        <a href='/tutorials/tags/endnote/' style='font-size:1em'>endnote</a>
      </li><li>
        <a href='/tutorials/tags/explorative-data-analysis/' style='font-size:1em'>explorative data analysis</a>
      </li><li>
        <a href='/tutorials/tags/gbif/' style='font-size:1em'>gbif</a>
      </li><li>
        <a href='/tutorials/tags/generalized-linear-regression/' style='font-size:1em'>generalized linear regression</a>
      </li><li>
        <a href='/tutorials/tags/ggplot2/' style='font-size:1.0285714285714285em'>ggplot2</a>
      </li><li>
        <a href='/tutorials/tags/gis/' style='font-size:1.2285714285714286em'>gis</a>
      </li><li>
        <a href='/tutorials/tags/git/' style='font-size:1.1714285714285715em'>git</a>
      </li><li>
        <a href='/tutorials/tags/gitbook/' style='font-size:1em'>gitbook</a>
      </li><li>
        <a href='/tutorials/tags/github/' style='font-size:1.0285714285714285em'>github</a>
      </li><li>
        <a href='/tutorials/tags/google/' style='font-size:1.0285714285714285em'>google</a>
      </li><li>
        <a href='/tutorials/tags/inbomd/' style='font-size:1.0285714285714285em'>INBOmd</a>
      </li><li>
        <a href='/tutorials/tags/inla/' style='font-size:1.0571428571428572em'>INLA</a>
      </li><li>
        <a href='/tutorials/tags/inlabru/' style='font-size:1em'>inlabru</a>
      </li><li>
        <a href='/tutorials/tags/installation/' style='font-size:1.2285714285714286em'>installation</a>
      </li><li>
        <a href='/tutorials/tags/literature/' style='font-size:1.1142857142857143em'>literature</a>
      </li><li>
        <a href='/tutorials/tags/maps/' style='font-size:1.1428571428571428em'>maps</a>
      </li><li>
        <a href='/tutorials/tags/markdown/' style='font-size:1.0285714285714285em'>markdown</a>
      </li><li>
        <a href='/tutorials/tags/mendeley/' style='font-size:1em'>mendeley</a>
      </li><li>
        <a href='/tutorials/tags/mixed-model/' style='font-size:1.1428571428571428em'>mixed model</a>
      </li><li>
        <a href='/tutorials/tags/multivariate-statistics/' style='font-size:1em'>multivariate statistics</a>
      </li><li>
        <a href='/tutorials/tags/open-science/' style='font-size:1.2em'>open science</a>
      </li><li>
        <a href='/tutorials/tags/packages/' style='font-size:1.0571428571428572em'>packages</a>
      </li><li>
        <a href='/tutorials/tags/pandoc/' style='font-size:1em'>pandoc</a>
      </li><li>
        <a href='/tutorials/tags/python/' style='font-size:1em'>python</a>
      </li><li>
        <a href='/tutorials/tags/queries/' style='font-size:1em'>queries</a>
      </li><li>
        <a href='/tutorials/tags/r/' style='font-size:2em'>r</a>
      </li><li>
        <a href='/tutorials/tags/reports/' style='font-size:1em'>reports</a>
      </li><li>
        <a href='/tutorials/tags/rmarkdown/' style='font-size:1.0285714285714285em'>rmarkdown</a>
      </li><li>
        <a href='/tutorials/tags/rstudio/' style='font-size:1.0571428571428572em'>rstudio</a>
      </li><li>
        <a href='/tutorials/tags/spreadsheet/' style='font-size:1em'>spreadsheet</a>
      </li><li>
        <a href='/tutorials/tags/sql/' style='font-size:1em'>SQL</a>
      </li><li>
        <a href='/tutorials/tags/styleguide/' style='font-size:1.0571428571428572em'>styleguide</a>
      </li><li>
        <a href='/tutorials/tags/tidyverse/' style='font-size:1.0857142857142856em'>tidyverse</a>
      </li><li>
        <a href='/tutorials/tags/uncertainty/' style='font-size:1.0285714285714285em'>uncertainty</a>
      </li><li>
        <a href='/tutorials/tags/version-control/' style='font-size:1.1428571428571428em'>version control</a>
      </li><li>
        <a href='/tutorials/tags/vmm/' style='font-size:1em'>vmm</a>
      </li><li>
        <a href='/tutorials/tags/webservice/' style='font-size:1.0571428571428572em'>webservice</a>
      </li><li>
        <a href='/tutorials/tags/windows/' style='font-size:1em'>windows</a>
      </li><li>
        <a href='/tutorials/tags/zotero/' style='font-size:1em'>zotero</a>
      </li></ul>
</div>


</section>
<section class='widget widget-social_menu sep-after'><nav aria-label='Social Menu'>
    <ul><li>
        <a href='https://github.com/inbo' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Github account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
</a>
      </li><li>
        <a href='https://twitter.com/INBOVlaanderen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Twitter account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"/>
  
</svg>
</a>
      </li><li>
        <a href='https://facebook.com/INBOVlaanderen' target='_blank' rel='noopener'>
          <span class='screen-reader-text'>Open Facebook account in new tab</span><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"/>
  
</svg>
</a>
      </li></ul>
  </nav>
</section>
<section class='widget widget-build_time sep-after'>
  <p><small>Built on: Wed Apr 14 16:27:41 UTC 2021</small></p>
</section></div>

  <div class='sidebar-overlay'></div>
</div><div class='main'><a class='screen-reader-text' href='#content'>Skip to Content</a>

<button id='sidebar-toggler' class='sidebar-toggler' aria-controls='sidebar'>
  <span class='screen-reader-text'>Toggle Sidebar</span>
  <span class='open'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="3" y1="12" x2="21" y2="12" />
  <line x1="3" y1="6" x2="21" y2="6" />
  <line x1="3" y1="18" x2="21" y2="18" />
  
</svg>
</span>
  <span class='close'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="18" y1="6" x2="6" y2="18" />
  <line x1="6" y1="6" x2="18" y2="18" />
  
</svg>
</span>
</button><div class='header-widgets'>
        <div class='container'>
    
    <style>.widget-breadcrumbs li:after{content:'\2f '}</style>
  <section class='widget widget-breadcrumbs sep-after'>
    <nav id='breadcrumbs'>
      <ol><li><a href='/tutorials/'>Home</a></li><li><a href='/tutorials/tutorials/'>Tutorials</a></li><li><span>Zero-inflation</span></li></ol>
    </nav>
  </section></div>
      </div>

      <header id='header' class='header site-header'>
        <div class='container sep-after'>
          <div class='header-info'><p class='site-title title'>INBO Tutorials</p><p class='desc site-desc'></p>
          </div>
        </div>
      </header>

      <main id='content'>


<article lang='en' class='entry'>
  <header class='header entry-header'>
  <div class='container sep-after'>
    <div class='header-info'>
      <h1 class='title'>Zero-inflation</h1>
      
<p class='desc'>Various ways in which zero-inflation can be detected and handled.</p>


    </div>
    <div class='entry-meta'>
  <span class='posted-on'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
  <line x1="16" y1="2" x2="16" y2="6"/>
  <line x1="8" y1="2" x2="8" y2="6"/>
  <line x1="3" y1="10" x2="21" y2="10"/>
  
</svg>
<span class='screen-reader-text'>Posted on </span>
  <time class='entry-date' datetime='2020-07-01T00:00:00Z'>2020, Jul 01</time>
</span>

  <span class='byline'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M21,21V20c0-2.76-4-5-9-5s-9,2.24-9,5v1"/>
  <path d="M16,6.37A4,4,0,1,1,12.63,3,4,4,0,0,1,16,6.37Z"/>
  
</svg>
<span class='screen-reader-text'> by </span><a href='/tutorials/authors/thierryo'>Thierry Onkelinx</a></span>
  <br/>
  
<span class='reading-time'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <circle cx="12" cy="12" r="10"/>
  <polyline points="12 6 12 12 15 15"/>
  
</svg>
13 mins read
</span>


  <span class="github-link">

    

        

        
            
        

        
            <a href='https://github.com/inbo/tutorials/blob/master/content/tutorials/r_zero_inflation/index.Rmd'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/>
  
</svg>
Improve this page</a>
        

        
    
</span>

</div>


  </div>
</header>

  
  

  <div class='container entry-content'><h2 id="used-packages">Used packages<a href="#used-packages" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h2>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">library</span>(ggplot2)
</code></pre></div><pre><code>## Warning: package 'ggplot2' was built under R version 4.0.2
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">library</span>(scales)
<span style="color:#0a0">library</span>(pscl)
</code></pre></div><pre><code>## Warning: package 'pscl' was built under R version 4.0.2

## Classes and Methods for R developed in the
## Political Science Computational Laboratory
## Department of Political Science
## Stanford University
## Simon Jackman
## hurdle and zeroinfl functions by Achim Zeileis
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">library</span>(MASS)
<span style="color:#0a0">library</span>(tidyr)
<span style="color:#0a0">library</span>(dplyr)
</code></pre></div><pre><code>## 
## Attaching package: 'dplyr'

## The following object is masked from 'package:MASS':
## 
##     select

## The following objects are masked from 'package:stats':
## 
##     filter, lag

## The following objects are masked from 'package:base':
## 
##     intersect, setdiff, setequal, union
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">library</span>(lme4)
</code></pre></div><pre><code>## Loading required package: Matrix

## 
## Attaching package: 'Matrix'

## The following objects are masked from 'package:tidyr':
## 
##     expand, pack, unpack
</code></pre>
<h1 id="lots-of-zeros-doesnt-imply-zero-inflation">Lots of zero’s doesn’t imply zero-inflation<a href="#lots-of-zeros-doesnt-imply-zero-inflation" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">set.seed</span>(<span style="color:#099">1234</span>)
n &lt;- <span style="color:#099">1e4</span>
n.sim &lt;- <span style="color:#099">1e3</span>
mean.poisson &lt;- <span style="color:#099">0.05</span>
mean.zeroinfl &lt;- <span style="color:#099">10000</span>
prop.zeroinfl &lt;- <span style="color:#099">0.1</span>
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dataset &lt;- <span style="color:#0a0">data.frame</span>(
  Poisson = <span style="color:#0a0">rpois</span>(n, lambda = mean.poisson)
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>() +
  <span style="color:#0a0">geom_linerange</span>(
    data = dataset %&gt;%
      <span style="color:#0a0">filter</span>(Poisson == <span style="color:#099">0</span>) %&gt;%
      <span style="color:#0a0">count</span>(Poisson),
    mapping = <span style="color:#0a0">aes</span>(
      x = Poisson,
      ymin = <span style="color:#099">0</span>,
      ymax = n
    )
  ) +
  <span style="color:#0a0">geom_histogram</span>(
    data = dataset %&gt;%
      <span style="color:#0a0">filter</span>(Poisson &gt; <span style="color:#099">0</span>),
    mapping = <span style="color:#0a0">aes</span>(x = Poisson),
    boundary = <span style="color:#099">0</span>
  )
</code></pre></div><pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
<p><img src="index_files/figure-gfm/unnamed-chunk-4-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">table</span>(dataset$Poisson)
</code></pre></div><pre><code>## 
##    0    1    2 
## 9533  462    5
</code></pre>
<p>The example above generates values from a Poisson distribution with mean
0.05. Although it has no zero-inflation, 95.3% of the values are zero.</p>
<h1 id="zero-inflation-can-also-occur-with-low-number-of-zeros">Zero-inflation can also occur with low number of zero’s<a href="#zero-inflation-can-also-occur-with-low-number-of-zeros" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dataset$ZeroInflatedPoisson &lt;- <span style="color:#0a0">rbinom</span>(n, size = <span style="color:#099">1</span>, prob = <span style="color:#099">1</span> - prop.zeroinfl) *
  <span style="color:#0a0">rpois</span>(n, lambda = mean.zeroinfl)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>() +
  <span style="color:#0a0">geom_linerange</span>(
    data = dataset %&gt;%
      <span style="color:#0a0">filter</span>(ZeroInflatedPoisson == <span style="color:#099">0</span>) %&gt;%
      <span style="color:#0a0">count</span>(ZeroInflatedPoisson),
    mapping = <span style="color:#0a0">aes</span>(
      x = ZeroInflatedPoisson,
      ymin = <span style="color:#099">0</span>,
      ymax = n
    )
  ) +
  <span style="color:#0a0">geom_histogram</span>(
    data = dataset %&gt;%
      <span style="color:#0a0">filter</span>(ZeroInflatedPoisson &gt; <span style="color:#099">0</span>),
    mapping = <span style="color:#0a0">aes</span>(x = ZeroInflatedPoisson),
    boundary = <span style="color:#099">0</span>
  )
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-7-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">table</span>(dataset$ZeroInflatedPoisson == <span style="color:#099">0</span>)
</code></pre></div><pre><code>## 
## FALSE  TRUE 
##  9007   993
</code></pre>
<p>The second example generates a data from a zero-inflated Poisson
distribution with mean 10^{4} and 10, % excess zero’s. The actual
proportion of zero’s is 9.9%.</p>
<h1 id="how-to-test-for-zero-inflation">How to test for zero-inflation<a href="#how-to-test-for-zero-inflation" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dataset &lt;- <span style="color:#0a0">expand.grid</span>(
  Mean = <span style="color:#0a0">c</span>(mean.poisson, mean.zeroinfl),
  Rep = <span style="color:#0a0">seq_len</span>(n)
)
dataset$Poisson &lt;- <span style="color:#0a0">rpois</span>(<span style="color:#0a0">nrow</span>(dataset), lambda = dataset$Mean)
dataset$ZeroInflatedPoisson &lt;- <span style="color:#0a0">rbinom</span>(<span style="color:#0a0">nrow</span>(dataset), size = <span style="color:#099">1</span>, prob = <span style="color:#099">1</span> - prop.zeroinfl) *
  <span style="color:#0a0">rpois</span>(<span style="color:#0a0">nrow</span>(dataset), lambda = dataset$Mean)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>() +
  <span style="color:#0a0">geom_linerange</span>(
    data = dataset %&gt;%
      <span style="color:#0a0">filter</span>(Poisson == <span style="color:#099">0</span>) %&gt;%
      <span style="color:#0a0">count</span>(Poisson),
    mapping = <span style="color:#0a0">aes</span>(
      x = Poisson,
      ymin = <span style="color:#099">0</span>,
      ymax = n
    )
  ) +
  <span style="color:#0a0">geom_histogram</span>(
    data = dataset %&gt;%
      <span style="color:#0a0">filter</span>(Poisson &gt; <span style="color:#099">0</span>),
    mapping = <span style="color:#0a0">aes</span>(x = Poisson),
    boundary = <span style="color:#099">0</span>
  )
</code></pre></div><pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
<p><img src="index_files/figure-gfm/unnamed-chunk-10-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>() +
  <span style="color:#0a0">geom_linerange</span>(
    data = dataset %&gt;%
      <span style="color:#0a0">filter</span>(ZeroInflatedPoisson == <span style="color:#099">0</span>) %&gt;%
      <span style="color:#0a0">count</span>(ZeroInflatedPoisson),
    mapping = <span style="color:#0a0">aes</span>(
      x = ZeroInflatedPoisson,
      ymin = <span style="color:#099">0</span>,
      ymax = n
    )
  ) +
  <span style="color:#0a0">geom_histogram</span>(
    data = dataset %&gt;%
      <span style="color:#0a0">filter</span>(ZeroInflatedPoisson &gt; <span style="color:#099">0</span>),
    mapping = <span style="color:#0a0">aes</span>(x = ZeroInflatedPoisson),
    boundary = <span style="color:#099">0</span>
  )
</code></pre></div><pre><code>## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
</code></pre>
<p><img src="index_files/figure-gfm/unnamed-chunk-11-1.png" alt=""><!-- raw HTML omitted --></p>
<p>For this example we generate a new dataset with two levels of Mean:
0.05, 10000.00. We generate both a Poisson and a zero-inflated Poisson
variable. The latter has 10, % excess zero’s. The proportion of zero’s
the variables are respectively 47.3% and 52.7%.</p>
<p>Let’s assume that our hypothesis is that all observations share the same
mean. Note that is clearly not the case. If this hypothesis would hold,
then we fit a simple intercept-only model.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">m.pois.simple &lt;- <span style="color:#0a0">glm</span>(Poisson ~ <span style="color:#099">1</span>, data = dataset, family = poisson)
m.zero.simple &lt;- <span style="color:#0a0">glm</span>(ZeroInflatedPoisson ~ <span style="color:#099">1</span>, data = dataset, family = poisson)
<span style="color:#0a0">summary</span>(m.pois.simple)
</code></pre></div><pre><code>## 
## Call:
## glm(formula = Poisson ~ 1, family = poisson, data = dataset)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -100.00  -100.00   -20.85    62.15    66.33  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   8.5172     0.0001   85172   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 138627905  on 19999  degrees of freedom
## Residual deviance: 138627905  on 19999  degrees of freedom
## AIC: 138739486
## 
## Number of Fisher Scoring iterations: 6
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">summary</span>(m.zero.simple)
</code></pre></div><pre><code>## 
## Call:
## glm(formula = ZeroInflatedPoisson ~ 1, family = poisson, data = dataset)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -94.96  -94.96  -94.96   70.19   74.27  
## 
## Coefficients:
##              Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept) 8.4137957  0.0001053   79899   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 143653204  on 19999  degrees of freedom
## Residual deviance: 143653204  on 19999  degrees of freedom
## AIC: 143753725
## 
## Number of Fisher Scoring iterations: 6
</code></pre>
<p>After fitting the model we generate at random a new response variable
based on the models and count the number of zero’s. This is repeated
several times so that we can get a distribion of zero’s based on the
model. Finally we compare the number of zero’s in the original dataset
with this distribution.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simulated &lt;- <span style="color:#0a0">data.frame</span>(
  PoissonSimple = <span style="color:#0a0">apply</span>(
    <span style="color:#0a0">simulate</span>(m.pois.simple, nsim = n.sim) == <span style="color:#099">0</span>,
    <span style="color:#099">2</span>,
    mean
  ),
  ZeroInflatedSimple = <span style="color:#0a0">apply</span>(
    <span style="color:#0a0">simulate</span>(m.zero.simple, nsim = n.sim) == <span style="color:#099">0</span>,
    <span style="color:#099">2</span>,
    mean
  )
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = PoissonSimple)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.01</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset$Poisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-14-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflatedSimple)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.01</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset$Poisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-15-1.png" alt=""><!-- raw HTML omitted --></p>
<p>In both cases none of the simulated values contains zero’s. The red line
indicates the observed proportion of zero’s with is clearly greater.
This indicates that we have either a poor model fit or zero-inflation.</p>
<h1 id="improving-the-model">Improving the model<a href="#improving-the-model" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<p>In the case of this example we have two groups with very different
means: one group with low mean generating lots of zero’s and one group
with large mean generating no zero’s. Adding this grouping improves the
model.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">m.pois.complex &lt;- <span style="color:#0a0">glm</span>(Poisson ~ <span style="color:#0a0">factor</span>(Mean), data = dataset, family = poisson)
m.zero.complex &lt;- <span style="color:#0a0">glm</span>(ZeroInflatedPoisson ~ <span style="color:#0a0">factor</span>(Mean), data = dataset, family = poisson)
<span style="color:#0a0">summary</span>(m.pois.complex)
</code></pre></div><pre><code>## 
## Call:
## glm(formula = Poisson ~ factor(Mean), family = poisson, data = dataset)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.6720  -0.3353  -0.3353   0.1405   4.2399  
## 
## Coefficients:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       -2.87884    0.04218  -68.25   &lt;2e-16 ***
## factor(Mean)10000 12.08917    0.04218  286.59   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 138627905  on 19999  degrees of freedom
## Residual deviance:     13118  on 19998  degrees of freedom
## AIC: 124702
## 
## Number of Fisher Scoring iterations: 6
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">summary</span>(m.zero.complex)
</code></pre></div><pre><code>## 
## Call:
## glm(formula = ZeroInflatedPoisson ~ factor(Mean), family = poisson, 
##     data = dataset)
## 
## Deviance Residuals: 
##      Min        1Q    Median        3Q       Max  
## -134.295    -0.301    -0.301    10.023    13.695  
## 
## Coefficients:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       -3.09224    0.04691  -65.93   &lt;2e-16 ***
## factor(Mean)10000 12.19918    0.04691  260.08   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 143653204  on 19999  degrees of freedom
## Residual deviance:  18653539  on 19998  degrees of freedom
## AIC: 18754062
## 
## Number of Fisher Scoring iterations: 5
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simulated$PoissonComplex &lt;- <span style="color:#0a0">apply</span>(
  <span style="color:#0a0">simulate</span>(m.pois.complex, nsim = n.sim) == <span style="color:#099">0</span>,
  <span style="color:#099">2</span>,
  mean
)
simulated$ZeroInflatedComplex &lt;- <span style="color:#0a0">apply</span>(
  <span style="color:#0a0">simulate</span>(m.zero.complex, nsim = n.sim) == <span style="color:#099">0</span>,
  <span style="color:#099">2</span>,
  mean
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = PoissonComplex)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.0005</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset$Poisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-18-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflatedComplex)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.0005</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset$ZeroInflatedPoisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-19-1.png" alt=""><!-- raw HTML omitted --></p>
<p>In case of the Poisson variable, 45.1% of the simulated dataset from the
complex model has more zero’s than the observed dataset. So this model
can captures the zero’s and there is not zero-inflation. In case of the
zero-inflated Poisson variable 0.0% of the simulated dataset from the
complex model has more zero’s than the observed dataset. Hence we
conclude that the zero’s are not modelled properly. We can’t improve the
model further with covariates, hence we’ll have to treat is a a
zero-inflated distribution.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">m.zero.zi &lt;- <span style="color:#0a0">zeroinfl</span>(
  ZeroInflatedPoisson ~ <span style="color:#0a0">factor</span>(Mean) | <span style="color:#099">1</span>,
  data = dataset,
  dist = <span style="color:#a50">&#34;</span><span style="color:#a50">poisson&#34;</span>
)
<span style="color:#0a0">summary</span>(m.zero.zi)
</code></pre></div><pre><code>## 
## Call:
## zeroinfl(formula = ZeroInflatedPoisson ~ factor(Mean) | 1, data = dataset, 
##     dist = &quot;poisson&quot;)
## 
## Pearson residuals:
##     Min      1Q  Median      3Q     Max 
## -3.0282 -0.2126 -0.2126  0.3297  9.1506 
## 
## Count model coefficients (poisson with log link):
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       -2.98879    0.04716  -63.37   &lt;2e-16 ***
## factor(Mean)10000 12.19909    0.04716  258.65   &lt;2e-16 ***
## 
## Zero-inflation model coefficients (binomial with logit link):
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -2.2170     0.0336  -65.98   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## Number of iterations in BFGS optimization: 13 
## Log-likelihood: -5.938e+04 on 3 Df
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">sim.zero.zi &lt;- <span style="color:#0a0">function</span>(model) {
  eta &lt;- <span style="color:#0a0">predict</span>(model, type = <span style="color:#a50">&#34;</span><span style="color:#a50">count&#34;</span>)
  prob &lt;- <span style="color:#0a0">predict</span>(model, type = <span style="color:#a50">&#34;</span><span style="color:#a50">zero&#34;</span>)
  new.value &lt;-
    <span style="color:#0a0">rbinom</span>(<span style="color:#0a0">length</span>(eta), size = <span style="color:#099">1</span>, prob = <span style="color:#099">1</span> - prob) *
      <span style="color:#0a0">rpois</span>(<span style="color:#0a0">length</span>(eta), lambda = eta)
  <span style="color:#0a0">mean</span>(new.value == <span style="color:#099">0</span>)
}
simulated$ZeroInflatedZI &lt;- <span style="color:#0a0">replicate</span>(n.sim, <span style="color:#0a0">sim.zero.zi</span>(m.zero.zi))
<span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflatedZI)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.0005</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset$ZeroInflatedPoisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-20-1.png" alt=""><!-- raw HTML omitted --></p>
<p>When we fit a proper zero-inflated model to the zero-inflated Poisson
variable, then 45.5% of the simulated datasets have more zero’s than the
observed dataset. So the zero-inflation is properly handled.</p>
<h1 id="modelling-zero-inflation-by-overdispersion">Modelling zero-inflation by overdispersion<a href="#modelling-zero-inflation-by-overdispersion" class="anchor"><svg height="22px" viewBox="0 0 24 24" width="22px"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"></path></svg></a></h1>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">m.zero.nb &lt;- <span style="color:#0a0">glm.nb</span>(ZeroInflatedPoisson ~ <span style="color:#0a0">factor</span>(Mean), data = dataset)
<span style="color:#0a0">summary</span>(m.zero.nb)
</code></pre></div><pre><code>## 
## Call:
## glm.nb(formula = ZeroInflatedPoisson ~ factor(Mean), data = dataset, 
##     init.theta = 0.6535490762, link = log)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -3.5298  -0.2963  -0.2963   0.0850   2.8393  
## 
## Coefficients:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       -3.09224    0.04854  -63.71   &lt;2e-16 ***
## factor(Mean)10000 12.19918    0.05009  243.56   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for Negative Binomial(0.6535) family taken to be 1)
## 
##     Null deviance: 130864  on 19999  degrees of freedom
## Residual deviance:  14676  on 19998  degrees of freedom
## AIC: 204749
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  0.65355 
##           Std. Err.:  0.00868 
## 
##  2 x log-likelihood:  -204742.76400
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dataset$ID &lt;- <span style="color:#0a0">seq_along</span>(dataset$Mean)
m.zero.olre &lt;- <span style="color:#0a0">glmer</span>(
  ZeroInflatedPoisson ~ <span style="color:#0a0">factor</span>(Mean) + (<span style="color:#099">1</span> | ID),
  data = dataset,
  family = poisson
)
<span style="color:#0a0">summary</span>(m.zero.olre)
</code></pre></div><pre><code>## Generalized linear mixed model fit by maximum likelihood (Laplace
##   Approximation) [glmerMod]
##  Family: poisson  ( log )
## Formula: ZeroInflatedPoisson ~ factor(Mean) + (1 | ID)
##    Data: dataset
## 
##       AIC       BIC    logLik  deviance  df.resid 
##  218344.4  218368.1 -109169.2  218338.4     19997 
## 
## Scaled residuals: 
##      Min       1Q   Median       3Q      Max 
## -0.99401 -0.06651 -0.06651  0.00113  0.81490 
## 
## Random effects:
##  Groups Name        Variance Std.Dev.
##  ID     (Intercept) 8.377    2.894   
## Number of obs: 20000, groups:  ID, 20000
## 
## Fixed effects:
##                   Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)       -5.38382    0.06961  -77.34   &lt;2e-16 ***
## factor(Mean)10000 13.64883    0.07490  182.23   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Correlation of Fixed Effects:
##             (Intr)
## fct(M)10000 -0.921
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simulated$ZeroInflatedNB &lt;- <span style="color:#0a0">apply</span>(
  <span style="color:#0a0">simulate</span>(m.zero.nb, nsim = n.sim) == <span style="color:#099">0</span>,
  <span style="color:#099">2</span>,
  mean
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflatedNB)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.0005</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset$ZeroInflatedPoisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-23-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simulated$ZeroInflatedOLRE &lt;- <span style="color:#0a0">apply</span>(
  <span style="color:#0a0">simulate</span>(m.zero.olre, nsim = n.sim) == <span style="color:#099">0</span>,
  <span style="color:#099">2</span>,
  mean
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflatedOLRE)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.0005</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset$ZeroInflatedPoisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-24-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">mean.2 &lt;- <span style="color:#099">5</span>
dataset2 &lt;- <span style="color:#0a0">expand.grid</span>(
  Mean = mean.2,
  Rep = <span style="color:#0a0">seq_len</span>(<span style="color:#099">100</span>)
)
dataset2$ZeroInflatedPoisson &lt;-
  <span style="color:#0a0">rbinom</span>(<span style="color:#0a0">nrow</span>(dataset2), size = <span style="color:#099">1</span>, prob = <span style="color:#099">1</span> - prop.zeroinfl) *
    <span style="color:#0a0">rpois</span>(<span style="color:#0a0">nrow</span>(dataset2), lambda = dataset2$Mean)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(dataset2, <span style="color:#0a0">aes</span>(x = ZeroInflatedPoisson)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">1</span>)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-26-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">m.zero2 &lt;- <span style="color:#0a0">glm</span>(ZeroInflatedPoisson ~ <span style="color:#099">1</span>, data = dataset2, family = poisson)
<span style="color:#0a0">summary</span>(m.zero2)
</code></pre></div><pre><code>## 
## Call:
## glm(formula = ZeroInflatedPoisson ~ 1, family = poisson, data = dataset2)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.9326  -0.6633  -0.1464   0.7731   2.6952  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.45862    0.04822   30.25   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for poisson family taken to be 1)
## 
##     Null deviance: 217.63  on 99  degrees of freedom
## Residual deviance: 217.63  on 99  degrees of freedom
## AIC: 508.69
## 
## Number of Fisher Scoring iterations: 5
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simulated$ZeroInflated2 &lt;- <span style="color:#0a0">apply</span>(
  <span style="color:#0a0">simulate</span>(m.zero2, nsim = n.sim) == <span style="color:#099">0</span>,
  <span style="color:#099">2</span>,
  mean
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflated2)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.01</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset2$ZeroInflatedPoisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-27-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">m.zero.nb2 &lt;- <span style="color:#0a0">glm.nb</span>(ZeroInflatedPoisson ~ <span style="color:#099">1</span>, data = dataset2)
<span style="color:#0a0">summary</span>(m.zero.nb2)
</code></pre></div><pre><code>## 
## Call:
## glm.nb(formula = ZeroInflatedPoisson ~ 1, data = dataset2, init.theta = 4.249064467, 
##     link = log)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -2.4375  -0.4811  -0.1038   0.5292   1.7364  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)   1.4586     0.0684   21.32   &lt;2e-16 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## (Dispersion parameter for Negative Binomial(4.2491) family taken to be 1)
## 
##     Null deviance: 130.63  on 99  degrees of freedom
## Residual deviance: 130.63  on 99  degrees of freedom
## AIC: 489.84
## 
## Number of Fisher Scoring iterations: 1
## 
## 
##               Theta:  4.25 
##           Std. Err.:  1.44 
## 
##  2 x log-likelihood:  -485.839
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simulated$ZeroInflatedNB2 &lt;- <span style="color:#0a0">apply</span>(
  <span style="color:#0a0">simulate</span>(m.zero.nb2, nsim = n.sim) == <span style="color:#099">0</span>,
  <span style="color:#099">2</span>,
  mean
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflatedNB2)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.01</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset2$ZeroInflatedPoisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-28-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">dataset2$ID &lt;- <span style="color:#0a0">seq_along</span>(dataset2$Mean)
m.zero.olre2 &lt;- <span style="color:#0a0">glmer</span>(
  ZeroInflatedPoisson ~ (<span style="color:#099">1</span> | ID),
  data = dataset2,
  family = poisson
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simulated$ZeroInflatedOLRE2 &lt;- <span style="color:#0a0">apply</span>(
  <span style="color:#0a0">simulate</span>(m.zero.olre2, nsim = n.sim) == <span style="color:#099">0</span>,
  <span style="color:#099">2</span>,
  mean
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflatedOLRE2)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.01</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset2$ZeroInflatedPoisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-30-1.png" alt=""><!-- raw HTML omitted --></p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">m.zero.zi2 &lt;- <span style="color:#0a0">zeroinfl</span>(
  ZeroInflatedPoisson ~ <span style="color:#099">1</span>,
  data = dataset2,
  dist = <span style="color:#a50">&#34;</span><span style="color:#a50">poisson&#34;</span>
)
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">summary</span>(m.zero.zi2)
</code></pre></div><pre><code>## 
## Call:
## zeroinfl(formula = ZeroInflatedPoisson ~ 1, data = dataset2, dist = &quot;poisson&quot;)
## 
## Pearson residuals:
##     Min      1Q  Median      3Q     Max 
## -1.5786 -0.4772 -0.1101  0.6241  2.4596 
## 
## Count model coefficients (poisson with log link):
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  1.61454    0.04905   32.92   &lt;2e-16 ***
## 
## Zero-inflation model coefficients (binomial with logit link):
##             Estimate Std. Error z value Pr(&gt;|z|)    
## (Intercept)  -1.7794     0.2912  -6.111  9.9e-10 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## Number of iterations in BFGS optimization: 5 
## Log-likelihood: -225.2 on 2 Df
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">simulated$ZeroInflatedZI2 &lt;- <span style="color:#0a0">replicate</span>(n.sim, <span style="color:#0a0">sim.zero.zi</span>(m.zero.zi2))
<span style="color:#0a0">ggplot</span>(simulated, <span style="color:#0a0">aes</span>(x = ZeroInflatedZI2)) +
  <span style="color:#0a0">geom_histogram</span>(binwidth = <span style="color:#099">0.01</span>) +
  <span style="color:#0a0">geom_vline</span>(xintercept = <span style="color:#0a0">mean</span>(dataset2$ZeroInflatedPoisson == <span style="color:#099">0</span>), colour = <span style="color:#a50">&#34;</span><span style="color:#a50">red&#34;</span>) +
  <span style="color:#0a0">scale_x_continuous</span>(label = percent)
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-32-1.png" alt=""><!-- raw HTML omitted --></p>
<p>A negative binomial distribution can capture some of the zero-inflation
by overdispersion. Especially in cases with low mean and few data. When
the mean is low, a reasonable portion of the zero origination comes from
the poisson distribution. However, the shape of the distribution is
different.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">distribution &lt;- <span style="color:#0a0">data.frame</span>(
  Count = <span style="color:#099">0</span>:<span style="color:#099">20</span>
)
distribution$Truth &lt;- <span style="color:#0a0">dpois</span>(
  distribution$Count,
  lambda = mean.2
) + <span style="color:#0a0">ifelse</span>(
  distribution$Count == <span style="color:#099">0</span>,
  prop.zeroinfl,
  <span style="color:#099">0</span>
)
distribution$Poisson &lt;- <span style="color:#0a0">dpois</span>(
  distribution$Count,
  lambda = <span style="color:#0a0">exp</span>(<span style="color:#0a0">coef</span>(m.zero2))
)
distribution$ZIPoisson &lt;- <span style="color:#0a0">dpois</span>(
  distribution$Count,
  lambda = <span style="color:#0a0">exp</span>(<span style="color:#0a0">coef</span>(m.zero.zi2)[1])
) + <span style="color:#0a0">ifelse</span>(
  distribution$Count == <span style="color:#099">0</span>,
  <span style="color:#0a0">plogis</span>(<span style="color:#0a0">coef</span>(m.zero.zi2)[2]),
  <span style="color:#099">0</span>
)

se &lt;- <span style="color:#0a0">sqrt</span>(<span style="color:#0a0">VarCorr</span>(m.zero.olre2)$ID)
z &lt;- <span style="color:#0a0">seq</span>(<span style="color:#0a0">qnorm</span>(<span style="color:#099">.001</span>, sd = se), <span style="color:#0a0">qnorm</span>(<span style="color:#099">.999</span>, sd = se), length = <span style="color:#099">101</span>)
dz &lt;- <span style="color:#0a0">dnorm</span>(z, sd = se)
dz &lt;- dz / <span style="color:#0a0">sum</span>(dz)
delta &lt;- <span style="color:#0a0">outer</span>(
  distribution$Count,
  <span style="color:#0a0">exp</span>(z + <span style="color:#0a0">fixef</span>(m.zero.olre2)),
  FUN = dpois
)
distribution$OLRE &lt;- delta %*% dz

distribution$NegBin &lt;- <span style="color:#0a0">dnbinom</span>(
  distribution$Count,
  size = m.zero.nb2$theta,
  mu = <span style="color:#0a0">exp</span>(<span style="color:#0a0">coef</span>(m.zero.nb2))
)
long &lt;- <span style="color:#0a0">gather</span>(distribution, key = <span style="color:#a50">&#34;</span><span style="color:#a50">Model&#34;</span>, value = <span style="color:#a50">&#34;</span><span style="color:#a50">Density&#34;</span>, -Count)
</code></pre></div><pre><code>## Warning: attributes are not identical across measure variables;
## they will be dropped
</code></pre>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r">long$Truth &lt;- long$Model == <span style="color:#a50">&#34;</span><span style="color:#a50">Truth&#34;</span>
</code></pre></div><div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-r" data-lang="r"><span style="color:#0a0">ggplot</span>(long, <span style="color:#0a0">aes</span>(x = Count, y = Density, colour = Model, linetype = Truth)) +
  <span style="color:#0a0">geom_line</span>()
</code></pre></div><p><img src="index_files/figure-gfm/unnamed-chunk-34-1.png" alt=""><!-- raw HTML omitted --></p>
</div>

  
<footer class='entry-footer'>
  <div class='container sep-before'><div class='categories'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M22,19a2,2,0,0,1-2,2H4a2,2,0,0,1-2-2V5A2,2,0,0,1,4,3H9l2,3h9a2,2,0,0,1,2,2Z"/>
  
</svg>
<span class='screen-reader-text'>Categories: </span><a class='category' href='/tutorials/categories/r/'>r</a>, <a class='category' href='/tutorials/categories/statistics/'>statistics</a></div>
<div class='tags'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <path d="M20.59,13.41l-7.17,7.17a2,2,0,0,1-2.83,0L2,12V2H12l8.59,8.59A2,2,0,0,1,20.59,13.41Z"/>
  <line x1="7" y1="7" x2="7" y2="7"/>
  
</svg>
<span class='screen-reader-text'>Tags: </span><a class='tag' href='/tutorials/tags/r/'>r</a>, <a class='tag' href='/tutorials/tags/analysis/'>analysis</a></div>

  </div>
</footer>


</article>

<nav class='entry-nav'>
  <div class='container'><div class='prev-entry sep-before'>
      <a href='/tutorials/tutorials/sql_styleguide/'>
        <span aria-hidden='true'><svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="20" y1="12" x2="4" y2="12"/>
  <polyline points="10 18 4 12 10 6"/>
  
</svg>
 Previous</span>
        <span class='screen-reader-text'>Previous post: </span>Styleguide SQL-scripts</a>
    </div><div class='next-entry sep-before'>
      <a href='/tutorials/tutorials/r_spde/'>
        <span class='screen-reader-text'>Next post: </span>Spatially correlated random effects with INLA<span aria-hidden='true'>Next <svg class='icon' viewbox='0 0 24 24' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' aria-hidden='true'>
  
  <line x1="4" y1="12" x2="20" y2="12"/>
  <polyline points="14 6 20 12 14 18"/>
  
</svg>
</span>
      </a>
    </div></div>
</nav>




      </main>

      <footer id='footer' class='footer'>
        <div class='container sep-before'><div class='copyright'>
  <p> &copy; 2018-2021 Research Institute for Nature and Forest (INBO) <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
</div>

        </div>
      </footer>

    </div>
  </div><script>window.__public_path__='\/tutorials\/assets\/js\/'</script>

<script src='/tutorials/assets/js/main.00df04b7.js'></script><script src='/tutorials/js/custom.js'></script>

</body>

</html>

